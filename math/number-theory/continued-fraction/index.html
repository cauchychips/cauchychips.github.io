
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Site prépa">
      
      
        <meta name="author" content="383494, CCXXXI, chunibyo-wly, Enter-tainer, Great-designer, megakite, Menci, shawlleyw, shuzhouliu, StudyingFather, Tiphereth-A, untitledunrevised, c-forrest">
      
      
        <link rel="canonical" href="https://cauchychips.github.io/math/number-theory/continued-fraction/">
      
      
        <link rel="prev" href="../zhou/">
      
      
        <link rel="next" href="../stern-brocot/">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>连分数 - CauchyChips</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../_static/css/extra.css?v=16">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#引入" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tête">
    <a href="../../.." title="CauchyChips" class="md-header__button md-logo" aria-label="CauchyChips" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CauchyChips
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              连分数
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/cauchychips/cauchychips.github.io" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cauchychips/cauchychips.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  Introduction

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../contest/" class="md-tabs__link">
          
  
  Informatique

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
  Mathématiques

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../lang/index.md" class="md-tabs__link">
          
  
  Physique

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../basic/" class="md-tabs__link">
          
  
  Français

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../search/" class="md-tabs__link">
          
  
  Anglais

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../dp/" class="md-tabs__link">
          
  
  TIPE

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../string/" class="md-tabs__link">
          
  
  Personnel

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Maths à lire

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CauchyChips" class="md-nav__button md-logo" aria-label="CauchyChips" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17z"/></svg>

    </a>
    CauchyChips
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cauchychips/cauchychips.github.io" title="Aller au dépôt" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cauchychips/cauchychips.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Présentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于本项目
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/htc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    如何参与
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/what-oi-wiki-is-not/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OI Wiki 不是什么
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/format/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    格式手册
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/symbol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学符号表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F.A.Q.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/mirrors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    镜像站列表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/thanks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    致谢
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Informatique
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Informatique
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    比赛相关简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    赛事
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            赛事
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/oi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OI 赛事与赛制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/icpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ICPC/CCPC 赛事与赛制
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    题型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            题型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    题型概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/interaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    交互题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习路线
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习资源
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    技巧
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            技巧
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    读入、输出优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/dictionary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分段打表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/common-mistakes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见错误
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/common-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见技巧
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contest/problemsetting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    出题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mathématiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Mathématiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具软件简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    代码编辑工具
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            代码编辑工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/emacs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emacs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VS Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/atom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Atom
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/eclipse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eclipse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/npp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notepad++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/kate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/devcpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dev-C++
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/clion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/geany/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geany
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/xcode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xcode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GUIDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/sublime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sublime Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/cpeditor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CP Editor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/editor/codeblocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code::Blocks
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    评测工具
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            评测工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/judger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    评测工具简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/judger/arbiter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arbiter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/judger/cena/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cena
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/judger/ccr-plus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CCR Plus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/judger/lemon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lemon
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/cmd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    命令行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/compiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/wsl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WSL (Windows 10)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/special-judge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Special Judge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testlib
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Testlib
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testlib 简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/validator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Validator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/interactor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interactor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/testlib/checker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Checker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/polygon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Polygon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/oj-tool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OJ 工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/latex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LaTeX 入门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Physique
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Physique
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    语言基础简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++ 基础
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            C++ 基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/helloworld.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello, World!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/basic.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ 语法基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/var.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    变量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/op.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_5" >
        
          
          <label class="md-nav__link" for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    流程控制语句
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5">
            <span class="md-nav__icon md-icon"></span>
            流程控制语句
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/branch.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分支
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/loop.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    循环
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    高级数据类型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            高级数据类型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/array.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/struct.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    结构体
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/union.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    联合体
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/pointer.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    指针
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/func.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/file-op.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文件操作
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++ 标准库
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            C++ 标准库
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ 标准库简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_2" >
        
          
          <label class="md-nav__link" for="__nav_4_3_2" id="__nav_4_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    STL 容器
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_2">
            <span class="md-nav__icon md-icon"></span>
            STL 容器
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/container.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STL 容器简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/iterator.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    迭代器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/sequence-container.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    序列式容器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/associative-container.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关联式容器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/unordered-container.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    无序关联式容器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/container-adapter.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    容器适配器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/algorithm.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    STL 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/bitset.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bitset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/string.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    string
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/csl/pair.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pair
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++ 进阶
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            C++ 进阶
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/class.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/namespace.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    命名空间
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/value-category.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    值类别
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/op-overload.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    重载运算符
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/reference.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/const.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/new.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    新版 C++ 特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/lambda.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lambda 表达式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_4_9" id="__nav_4_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    pb_ds
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_9">
            <span class="md-nav__icon md-icon"></span>
            pb_ds
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/pb-ds/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pb_ds 简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/pb-ds/pq.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    堆
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/pb-ds/tree.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    平衡树
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/optimizations.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译优化
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/cpp-other-langs.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ 与其他常用语言的区别
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/pas-cpp.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pascal 转 C++ 急救
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/python.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python 速成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 速成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lang/java-pro.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 进阶
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Français
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Français
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    算法基础简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    复杂度
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            复杂度
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/complexity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    复杂度简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/amortized-analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    均摊复杂度
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/enumerate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    枚举
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/simulate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    模拟
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/divide-and-conquer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    递归 & 分治
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/greedy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    贪心
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    排序
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            排序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/sort-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    排序简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/selection-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    选择排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/bubble-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    冒泡排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/insertion-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    插入排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/counting-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计数排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/radix-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基数排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/quick-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/merge-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    归并排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/heap-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    堆排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/bucket-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    桶排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/shell-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    希尔排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/tournament-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    锦标赛排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/tim-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tim 排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/stl-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    排序相关 STL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/use-of-sort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    排序应用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/prefix-sum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前缀和 & 差分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/binary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/binary-lifting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    倍增
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../basic/construction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构造
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Anglais
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Anglais
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    搜索部分简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/dfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DFS（搜索）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/bfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BFS（搜索）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/bidirectional/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    双向搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/heuristic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    启发式搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/astar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A*
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/iterative/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    迭代加深搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/idastar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IDA*
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/backtracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    回溯法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/dlx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dancing Links
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/alpha-beta/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Alpha-Beta 剪枝
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../search/opt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    优化
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TIPE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            TIPE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态规划部分简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态规划基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/memo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    记忆化搜索
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/knapsack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    背包 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/interval/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    区间 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/dag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DAG 上的 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树形 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    状压 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数位 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/plug/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    插头 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/count/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计数 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/dynamic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概率 DP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_14" >
        
          
          <label class="md-nav__link" for="__nav_7_14" id="__nav_7_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DP 优化
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_14">
            <span class="md-nav__icon md-icon"></span>
            DP 优化
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/opt/monotonous-queue-stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    单调队列/单调栈优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/opt/slope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    斜率优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/opt/quadrangle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    四边形不等式优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/opt/state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    状态设计优化
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../dp/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    其它 DP 方法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Personnel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Personnel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符串部分简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符串基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/lib-func/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    标准库
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/match/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符串匹配
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字符串哈希
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/trie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字典树 (Trie)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/kmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前缀函数与 KMP 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/bm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boyer–Moore 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/z-func/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Z 函数（扩展 KMP）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/automaton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/ac-automaton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AC 自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_12" >
        
          
          <label class="md-nav__link" for="__nav_8_12" id="__nav_8_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    后缀数组 (SA)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_12">
            <span class="md-nav__icon md-icon"></span>
            后缀数组 (SA)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/sa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀数组简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/sa-optimal-inplace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最优原地后缀排序算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀自动机 (SAM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/suffix-bst/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀平衡树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/general-sam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    广义后缀自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/suffix-tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    后缀树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/manacher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manacher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    回文树
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/seq-automaton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    序列自动机
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/minimal-string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最小表示法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/lyndon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lyndon 分解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../string/main-lorentz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Main–Lorentz 算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" checked>
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Maths à lire
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Maths à lire
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数学部分简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    符号
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    进位制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    位运算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binary-set/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二进制集合操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../balanced-ternary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    平衡三进制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bignum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高精度计算
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binary-exponentiation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速幂
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../permutation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    置换和排列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coordinate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    弧度制与坐标系
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    复数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_12" checked>
        
          
          <label class="md-nav__link" for="__nav_9_12" id="__nav_9_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数论
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_12_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_9_12">
            <span class="md-nav__icon md-icon"></span>
            数论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数论基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    素数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最大公约数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sqrt-decomposition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数论分块
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../euler-totient/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欧拉函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sieve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    筛法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meissel-lehmer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meissel–Lehmer 算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pollard-rho/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分解质因数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bezouts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    裴蜀定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../euclidean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类欧几里德算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fermat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欧拉定理 & 费马小定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inverse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    乘法逆元
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性同余方程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    中国剩余定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lift-the-exponent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    升幂引理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wilson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    威尔逊定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lucas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    卢卡斯定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../congruence-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    同余方程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quad-residue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二次剩余
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../primitive-root/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    原根
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../discrete-logarithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    离散对数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../residue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    剩余
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mobius/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    莫比乌斯反演
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../du/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    杜教筛
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../powerful-number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Powerful Number 筛
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../min-25/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Min_25 筛
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zhou/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    洲阁筛
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    连分数
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    连分数
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#引入" class="md-nav__link">
    <span class="md-ellipsis">
      引入
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#连分数" class="md-nav__link">
    <span class="md-ellipsis">
      连分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="连分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#简单连分数" class="md-nav__link">
    <span class="md-ellipsis">
      简单连分数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#连分数表示的求法" class="md-nav__link">
    <span class="md-ellipsis">
      连分数表示的求法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#渐近分数" class="md-nav__link">
    <span class="md-ellipsis">
      渐近分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="渐近分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#递推关系" class="md-nav__link">
    <span class="md-ellipsis">
      递推关系
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#误差估计" class="md-nav__link">
    <span class="md-ellipsis">
      误差估计
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#丢番图逼近" class="md-nav__link">
    <span class="md-ellipsis">
      丢番图逼近
    </span>
  </a>
  
    <nav class="md-nav" aria-label="丢番图逼近">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#用渐近分数逼近实数" class="md-nav__link">
    <span class="md-ellipsis">
      用渐近分数逼近实数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第一类最佳逼近中间分数" class="md-nav__link">
    <span class="md-ellipsis">
      第一类最佳逼近：中间分数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第二类最佳逼近" class="md-nav__link">
    <span class="md-ellipsis">
      第二类最佳逼近
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#渐近分数的判定" class="md-nav__link">
    <span class="md-ellipsis">
      渐近分数的判定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#几何解释" class="md-nav__link">
    <span class="md-ellipsis">
      几何解释
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#连分数的树" class="md-nav__link">
    <span class="md-ellipsis">
      连分数的树
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#分式线性变换" class="md-nav__link">
    <span class="md-ellipsis">
      分式线性变换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="分式线性变换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#连分数的四则运算" class="md-nav__link">
    <span class="md-ellipsis">
      连分数的四则运算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#循环连分数" class="md-nav__link">
    <span class="md-ellipsis">
      循环连分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="循环连分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#二次无理数" class="md-nav__link">
    <span class="md-ellipsis">
      二次无理数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#纯循环连分数" class="md-nav__link">
    <span class="md-ellipsis">
      纯循环连分数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#例题" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#习题" class="md-nav__link">
    <span class="md-ellipsis">
      习题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#参考文献与拓展阅读" class="md-nav__link">
    <span class="md-ellipsis">
      参考文献与拓展阅读
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stern-brocot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stern–Brocot 树与 Farey 序列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quadratic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    二次域
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pell-equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pell 方程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_13" >
        
          
          <label class="md-nav__link" for="__nav_9_13" id="__nav_9_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    多项式与生成函数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_13">
            <span class="md-nav__icon md-icon"></span>
            多项式与生成函数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多项式与生成函数简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/fundamental/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    代数基本定理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/fft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速傅里叶变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/ntt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速数论变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/fwt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速沃尔什变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/czt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chirp Z 变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/newton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多项式牛顿迭代
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/multipoint-eval-interpolation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多项式多点求值|快速插值
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/elementary-func/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多项式初等函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/linear-recurrence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常系数齐次线性递推
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/shift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多项式平移|连续点值平移
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/symbolic-method/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    符号化方法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/lagrange-inversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lagrange 反演
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/comp-rev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    形式幂级数复合|复合逆
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/ogf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    普通生成函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/egf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    指数生成函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../poly/dgf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    狄利克雷生成函数
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_14" >
        
          
          <label class="md-nav__link" for="__nav_9_14" id="__nav_9_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    组合数学
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_14">
            <span class="md-nav__icon md-icon"></span>
            组合数学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/combination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    排列组合
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/drawer-principle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    抽屉原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/inclusion-exclusion-principle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    容斥原理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/fibonacci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    斐波那契数列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/derangement/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    错位排列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/catalan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    卡特兰数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/stirling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    斯特林数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/bell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    贝尔数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/bernoulli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    伯努利数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/entringer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entringer Number
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/eulerian/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Eulerian Number
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/partition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分拆数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/vandermonde-convolution/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    范德蒙德卷积
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/polya/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pólya 计数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../combinatorics/graph-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    图论计数
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_15" >
        
          
          <label class="md-nav__link" for="__nav_9_15" id="__nav_9_15_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    线性代数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_15">
            <span class="md-nav__icon md-icon"></span>
            线性代数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性代数简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/vector/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    向量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/product/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内积和外积
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/matrix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    矩阵
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/elementary-operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    初等变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/determinant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    行列式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/vector-space/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性空间
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/basis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性基
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/linear-mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性映射
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/char-poly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    特征多项式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/diagonalization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    对角化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-algebra/jordan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jordan标准型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_16" >
        
          
          <label class="md-nav__link" for="__nav_9_16" id="__nav_9_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    线性规划
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_16">
            <span class="md-nav__icon md-icon"></span>
            线性规划
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linear-programming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    线性规划简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simplex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    单纯形算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_17" >
        
          
          <label class="md-nav__link" for="__nav_9_17" id="__nav_9_17_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    抽象代数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_17">
            <span class="md-nav__icon md-icon"></span>
            抽象代数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基本概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/group-theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    群论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/ring-theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    环论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/field-theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    域论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../algebra/schreier-sims/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schreier–Sims 算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_18" >
        
          
          <label class="md-nav__link" for="__nav_9_18" id="__nav_9_18_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    概率论
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_18">
            <span class="md-nav__icon md-icon"></span>
            概率论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../probability/basic-conception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基本概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../probability/conditional-probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    条件概率与独立性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../probability/random-variable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    随机变量
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../probability/exp-var/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    随机变量的数字特征
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../probability/concentration-inequality/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概率不等式
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_19" >
        
          
          <label class="md-nav__link" for="__nav_9_19" id="__nav_9_19_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    博弈论
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_19">
            <span class="md-nav__icon md-icon"></span>
            博弈论
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../game-theory/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博弈论简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../game-theory/impartial-game/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    公平组合游戏
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../game-theory/partizan-game/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    非公平组合游戏
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../game-theory/misere-game/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    反常游戏
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_20" >
        
          
          <label class="md-nav__link" for="__nav_9_20" id="__nav_9_20_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数值算法
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_20">
            <span class="md-nav__icon md-icon"></span>
            数值算法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numerical/interp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    插值
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numerical/integral/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数值积分
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numerical/gauss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    高斯消元
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../numerical/newton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    牛顿迭代法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fourier-motzkin-elimination/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    傅里叶-莫茨金消元法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../order-theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    序理论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../young-tableau/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    杨氏矩阵
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../matroid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    拟阵
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../berlekamp-massey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Berlekamp–Massey 算法
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#引入" class="md-nav__link">
    <span class="md-ellipsis">
      引入
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#连分数" class="md-nav__link">
    <span class="md-ellipsis">
      连分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="连分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#简单连分数" class="md-nav__link">
    <span class="md-ellipsis">
      简单连分数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#连分数表示的求法" class="md-nav__link">
    <span class="md-ellipsis">
      连分数表示的求法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#渐近分数" class="md-nav__link">
    <span class="md-ellipsis">
      渐近分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="渐近分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#递推关系" class="md-nav__link">
    <span class="md-ellipsis">
      递推关系
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#误差估计" class="md-nav__link">
    <span class="md-ellipsis">
      误差估计
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#丢番图逼近" class="md-nav__link">
    <span class="md-ellipsis">
      丢番图逼近
    </span>
  </a>
  
    <nav class="md-nav" aria-label="丢番图逼近">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#用渐近分数逼近实数" class="md-nav__link">
    <span class="md-ellipsis">
      用渐近分数逼近实数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第一类最佳逼近中间分数" class="md-nav__link">
    <span class="md-ellipsis">
      第一类最佳逼近：中间分数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#第二类最佳逼近" class="md-nav__link">
    <span class="md-ellipsis">
      第二类最佳逼近
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#渐近分数的判定" class="md-nav__link">
    <span class="md-ellipsis">
      渐近分数的判定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#几何解释" class="md-nav__link">
    <span class="md-ellipsis">
      几何解释
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#连分数的树" class="md-nav__link">
    <span class="md-ellipsis">
      连分数的树
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#分式线性变换" class="md-nav__link">
    <span class="md-ellipsis">
      分式线性变换
    </span>
  </a>
  
    <nav class="md-nav" aria-label="分式线性变换">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#连分数的四则运算" class="md-nav__link">
    <span class="md-ellipsis">
      连分数的四则运算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#循环连分数" class="md-nav__link">
    <span class="md-ellipsis">
      循环连分数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="循环连分数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#二次无理数" class="md-nav__link">
    <span class="md-ellipsis">
      二次无理数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#纯循环连分数" class="md-nav__link">
    <span class="md-ellipsis">
      纯循环连分数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#例题" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#习题" class="md-nav__link">
    <span class="md-ellipsis">
      习题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#参考文献与拓展阅读" class="md-nav__link">
    <span class="md-ellipsis">
      参考文献与拓展阅读
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/cauchychips/cauchychips.github.io/math/number-theory/continued-fraction.md" title="Editer cette page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


  <h1>连分数</h1>

<h2 data-original-document-end="5" data-original-document-start="0" id="引入">引入<a class="headerlink" href="#引入" title="Permanent link"></a></h2>
<p data-original-document-end="115" data-original-document-start="7">连分数可以将实数表示为一个收敛的有理数数列的极限。这个数列中的有理数易于计算，而且提供了这个实数的最佳逼近，因而在算法竞赛中常常会用到连分数。除此之外，连分数还和欧几里得算法密切相关，因而可以应用到一系列数论问题中。</p>
<details class="info" data-original-document-end="320" data-original-document-start="117" open="open">
<summary>关于连分数相关的算法实现</summary>
<p>本文会提供一系列的连分数的算法实现，其中部分算法可能无法保证计算中间过程所涉及的整数都在 32 位或 64 位整型变量的取值范围内。对于这种情形，请参考相应的 Python 的实现，或将 C++ 实现中的整型变量替换为 <a href="../../bignum/">高精度整数类</a>。为突出重点，本文行文过程中的部分代码可能会调用前文实现过的函数而不再重复给出实现。</p>
</details>
<h2 data-original-document-end="328" data-original-document-start="322" id="连分数">连分数<a class="headerlink" href="#连分数" title="Permanent link"></a></h2>
<p data-original-document-end="368" data-original-document-start="330"><strong>连分数</strong>（continued fraction）本身只是一种形式记号。</p>
<details class="abstract" data-original-document-end="618" data-original-document-start="370" open="open">
<summary>有限连分数</summary>
<p>对于数列 <span class="arithmatex">\(\{a_k\}_{i=0}^n\)</span>，连分数 <span class="arithmatex">\([a_0,a_1,\cdots,a_n]\)</span> 表示展开式</p>
<div class="arithmatex">\[
x = a_0+\dfrac{1}{a_1+\dfrac{1}{a_2+\dfrac{1}{\cdots+\dfrac{1}{a_n}}}}.
\]</div>
<p>连分数有意义，当且仅当对应的展开式有意义。这些 <span class="arithmatex">\(a_k\)</span> 称为连分数的 <strong>项</strong>（term）或 <strong>系数</strong>（coefficient）。</p>
</details>
<details class="info" data-original-document-end="733" data-original-document-start="620" open="open">
<summary>记号</summary>
<p>更一般的连分数允许展开式中的分子不恒为 <span class="arithmatex">\(1\)</span>，相应的连分数记号也需要修改，这超出了本文的范畴。另外，有些文献中会将第一个逗号「<span class="arithmatex">\(,\)</span>」写作分号「<span class="arithmatex">\(;\)</span>」，这与本文的记号在含义上没有差异。</p>
</details>
<p data-original-document-end="755" data-original-document-start="735">当然，连分数还可以推广到无穷数列的情形。</p>
<details class="abstract" data-original-document-end="840" data-original-document-start="757" open="open">
<summary>无限连分数</summary>
<p>对于无穷数列 <span class="arithmatex">\(\{a_k\}_{i=0}^\infty\)</span>，连分数 <span class="arithmatex">\([a_0,a_1,\cdots]\)</span> 表示极限</p>
<div class="arithmatex" data-original-document-end="1792" data-original-document-start="1790">\[
x = \lim_{k\rightarrow\infty} x_k = \lim_{k\rightarrow\infty} [a_0,a_1,\cdots,a_k].
\]</div>
<p>连分数有意义，当且仅当对应的极限有意义。其中，<span class="arithmatex">\(x_k=[a_0,a_1,\cdots,a_k]\)</span> 称为 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个 <strong>渐近分数</strong>（convergent）或 <strong>收敛子</strong>，而 <span class="arithmatex">\(r_k=[a_k,a_{k+1},\cdots]\)</span> 称为 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个 <strong>余项</strong> 或 <strong>完全商</strong>（complete quotient）。相应地，项 <span class="arithmatex">\(a_k\)</span> 有时也称为第 <span class="arithmatex">\(k\)</span> 个 <strong>部分商</strong>（partial quotient）。</p>
</details>
<h3 id="简单连分数">简单连分数<a class="headerlink" href="#简单连分数" title="Permanent link"></a></h3>
<p>数论中，主要考虑连分数的项都是整数的情形。</p>
<details class="abstract" open="open">
<summary>简单连分数</summary>
<p>对于连分数 <span class="arithmatex">\([a_0,a_1,\cdots]\)</span>，如果 <span class="arithmatex">\(a_0\)</span> 是整数，<span class="arithmatex">\(a_1,a_2,\cdots\)</span> 都是正整数，则称它为 <strong>简单连分数</strong>（simple continued fraction），也简称 <strong>连分数</strong>。如果数列 <span class="arithmatex">\(\{a_i\}\)</span> 有限，则称为 <strong>有限（简单）连分数</strong>；否则称为 <strong>无限（简单）连分数</strong>。而且，<span class="arithmatex">\(a_0\)</span> 称为它的 <strong>整数部分</strong>（integer part）。</p>
</details>
<p>除非特别说明，本文提到的连分数都指的是简单连分数。可以证明，无限的简单连分数必然是收敛的，而且简单连分数的余项也一定是正的。</p>
<p>连分数有如下基本性质：</p>
<details class="note" open="open">
<summary>性质</summary>
<p>设实数 <span class="arithmatex">\(x=[a_0,a_1,a_2,\cdots]\)</span>。那么，成立如下性质：</p>
<ol>
<li>对于任意 <span class="arithmatex">\(k\in\mathbf Z\)</span>，有 <span class="arithmatex">\(x+k=[a_0+k,a_1,a_2,\cdots]\)</span>；</li>
<li>对实数 <span class="arithmatex">\(x&gt;1\)</span>，有 <span class="arithmatex">\(a_0&gt;0\)</span>，且它的倒数 <span class="arithmatex">\(x^{-1}=[0,a_0,a_1,a_2,\cdots]\)</span>。</li>
</ol>
</details>
<p>有限连分数对应的是有理数。每个有理数都有且仅有两种方式可以表示成连分数，长度必然一奇一偶。这两种方式唯一的区别在于最后一项是否为 <span class="arithmatex">\(1\)</span>，即</p>
<div class="arithmatex">\[
x = [a_0,a_1,\cdots,a_n] = [a_0,a_1,\cdots,a_n-1,1].
\]</div>
<p data-original-document-end="1963" data-original-document-start="1850">这两个连分数称为有理数 <span class="arithmatex">\(x\)</span> 的 <strong>连分数表示</strong>（continued fraction representation）。其中，末项不为一的称为标准表示，末项为一的称为非标准表示。<sup id="fnref:one-representation"><a class="footnote-ref" href="#fn:one-representation">1</a></sup></p>
<details class="example" data-original-document-end="2014" data-original-document-start="1965">
<summary>例子</summary>
<p>有理数 <span class="arithmatex">\(x=\dfrac{5}{3}\)</span> 的连分数表示为</p>
<div class="arithmatex">\[
\begin{aligned}
x = [1,1,1,1] &amp;= 1+\dfrac{1}{1+\dfrac{1}{1+\dfrac{1}{1}}},\\
x = [1,1,2] &amp;= 1+\dfrac{1}{1+\dfrac{1}{2}}.
\end{aligned}
\]</div>
</details>
<p data-original-document-end="2229" data-original-document-start="2182">无限连分数对应的是无理数。而且，每个无理数仅有唯一的方式表示为连分数，称为无理数的连分数表示。</p>
<h3 id="连分数表示的求法">连分数表示的求法<a class="headerlink" href="#连分数表示的求法" title="Permanent link"></a></h3>
<p data-original-document-end="2292" data-original-document-start="2245">要求某个实数 <span class="arithmatex">\(x\)</span> 的连分数表示，只需要注意到它的余项 <span class="arithmatex">\(r_k\)</span> 如果不是整数，就一定满足</p>
<div class="arithmatex">\[
r_k = [a_k,a_{k+1},\cdots] = [a_k,r_{k+1}] = a_k + \dfrac{1}{r_{k+1}}.
\]</div>
<p data-original-document-end="2409" data-original-document-start="2372">而且，<span class="arithmatex">\(r_{k+1}&gt;1\)</span>。因此，可以从 <span class="arithmatex">\(r_0=x\)</span> 开始递归地计算</p>
<div class="arithmatex">\[
a_k = \lfloor r_k\rfloor,\ r_{k+1} = \dfrac{1}{r_k-a_k}.
\]</div>
<p data-original-document-end="2568" data-original-document-start="2475">这个过程产生的数列 <span class="arithmatex">\(\{a_k\}\)</span> 总是唯一确定的，除非某个余项 <span class="arithmatex">\(r_k\)</span> 成为整数。如果出现了 <span class="arithmatex">\(r_k\)</span> 是整数，则说明过程应当终止，可以选择输出相应的标准表示或者非标准表示。</p>
<p data-original-document-end="2699" data-original-document-start="2570">在算法竞赛中，往往处理的都是有理数 <span class="arithmatex">\(x=\dfrac{p}{q}\)</span> 的情形。此时，每个余项 <span class="arithmatex">\(r_k\)</span> 都是有理数 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span>，而且对于 <span class="arithmatex">\(k&gt;0\)</span>，因为 <span class="arithmatex">\(r_k&gt;1\)</span>，就总有 <span class="arithmatex">\(p_k&gt;q_k\)</span>。具体计算上述递推关系，可以发现</p>
<div class="arithmatex">\[
a_k = \left\lfloor\frac{p_k}{q_k}\right\rfloor,\ r_{k+1} = \dfrac{1}{r_k-a_k} = \dfrac{q_k}{p_k-a_kq_k} = \dfrac{q_k}{p_k\bmod q_k}.
\]</div>
<p data-original-document-end="3005" data-original-document-start="2841">此时的计算过程实际上是对 <span class="arithmatex">\(p\)</span> 和 <span class="arithmatex">\(q\)</span> 做 <a href="../gcd/#欧几里得算法">辗转相除法</a>。这也说明，对于有理数 <span class="arithmatex">\(r=\dfrac{p}{q}\)</span>，连分数表示的长度是 <span class="arithmatex">\(O(\log\min\{p, q\})\)</span> 的。计算有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 的复杂度也是 <span class="arithmatex">\(O(\log\min\{p, q\})\)</span> 的。</p>
<details class="example" data-original-document-end="3313" data-original-document-start="3007" open="open">
<summary>参考实现</summary>
<p>给定分数的分子 <span class="arithmatex">\(p\)</span> 和分母 <span class="arithmatex">\(q\)</span>，输出连分数的系数序列 <span class="arithmatex">\([a_0,a_1,\cdots,a_n]\)</span>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">C++</label><label for="__tabbed_1_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Find the continued fraction representation of P/Q.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">fraction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find the continued fraction representation of P/Q.</span>
<span class="k">def</span> <span class="nf">fraction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">q</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span> <span class="o">//</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span> <span class="o">%</span> <span class="n">q</span>
    <span class="k">return</span> <span class="n">a</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h2 data-original-document-end="3322" data-original-document-start="3315" id="渐近分数">渐近分数<a class="headerlink" href="#渐近分数" title="Permanent link"></a></h2>
<p data-original-document-end="3479" data-original-document-start="3324">在连分数的定义中介绍了渐近分数的概念。实数的渐近分数就是它的连分数表示的渐近分数：在实数 <span class="arithmatex">\(x\)</span> 的连分数表示中，只保留前 <span class="arithmatex">\(k\)</span> 个项，得到的连分数 <span class="arithmatex">\(x_k\)</span> 就称为实数 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数。实数 <span class="arithmatex">\(x\)</span> 的渐近分数 <span class="arithmatex">\(x_k\)</span> 都是有理数，而且序列 <span class="arithmatex">\(\{x_k\}\)</span> 收敛于实数 <span class="arithmatex">\(x\)</span>。</p>
<details class="example" data-original-document-end="4144" data-original-document-start="3481">
<summary>例子：黄金分割比的渐近分数</summary>
<p>连分数 <span class="arithmatex">\(x=[1,1,1,1,\cdots]\)</span> 的前几个渐近分数分别是</p>
<div class="arithmatex">\[
\begin{aligned}
x_0 &amp;= [1]=1,\\
x_1 &amp;= [1,1]=2,\\
x_2 &amp;= [1,1,1]=\dfrac{3}{2},\\
x_3 &amp;= [1,1,1,1]=\dfrac{5}{3},\\
x_4 &amp;= [1,1,1,1,1]=\dfrac{8}{5}.
\end{aligned}
\]</div>
<p>可以归纳地证明</p>
<div class="arithmatex">\[
x_k = \frac{F_{k+2}}{F_{k+1}},
\]</div>
<p>其中，<span class="arithmatex">\(\{F_k\}\)</span> 是 <a href="../../combinatorics/fibonacci/">斐波那契数列</a>。根据它的通项公式可知，</p>
<div class="arithmatex">\[
x_k = \frac{\phi^{k+2}-(-\phi)^{-(k+2)}}{\phi^{k+1}-(-\phi)^{-(k+1)}},
\]</div>
<p>其中的 <span class="arithmatex">\(\phi=\dfrac{1+\sqrt{5}}{2}\)</span> 是黄金分割比。当 <span class="arithmatex">\(k\)</span> 趋于无穷时，有</p>
<div class="arithmatex">\[
x=\lim_{k\rightarrow\infty}x_k=\phi.
\]</div>
<p>因而，连分数 <span class="arithmatex">\(x=[1,1,1,1,\cdots]\)</span> 表示的是黄金分割比 <span class="arithmatex">\(\phi\)</span>。</p>
</details>
<p data-original-document-end="4189" data-original-document-start="4146">这些渐近分数趋近于相应的实数，所以可以用于逼近该实数。为此，有必要了解渐近分数的性质。</p>
<h3 data-original-document-end="4199" data-original-document-start="4191" id="递推关系">递推关系<a class="headerlink" href="#递推关系" title="Permanent link"></a></h3>
<p data-original-document-end="4271" data-original-document-start="4201">首先，要解决这些渐近分数的计算问题。虽然渐近分数总是在连分数的后面添加一项，但是并不需要每次都重新计算它的值。其实，渐近分数有如下递推关系：</p>
<details data-original-document-end="4506" data-original-document-start="4273" open="open">
<summary>递推公式</summary>
<p>对于连分数 <span class="arithmatex">\(x=[a_0,a_1,a_2,\cdots]\)</span>，设它的第 <span class="arithmatex">\(k\)</span> 个渐近分数 <span class="arithmatex">\(x_k\)</span> 可以写成分数 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span>。那么，有</p>
<div class="arithmatex">\[
\begin{aligned}
p_k &amp;= a_kp_{k-1}+p_{k-2},\\
q_k &amp;= a_kq_{k-1}+q_{k-2}.
\end{aligned}
\]</div>
<p>递推的起点是（形式）分数</p>
<div class="arithmatex">\[
x_{-1}=\frac{p_{-1}}{q_{-1}}=\frac{1}{0},\ x_{-2}=\frac{p_{-2}}{q_{-2}}=\frac{0}{1}.
\]</div>
</details>
<details class="note" data-original-document-end="6193" data-original-document-start="4612">
<summary>证明</summary>
<p>渐近分数 <span class="arithmatex">\(x_k\)</span> 的分子和分母可以看作 <span class="arithmatex">\(a_0, a_1, \cdots, a_k\)</span> 的多元多项式：</p>
<div class="arithmatex">\[
r_k = \frac{P_k(a_0, a_1, \cdots, a_k)}{Q_k(a_0,a_1, \cdots, a_k)}.
\]</div>
<p>根据渐近分数的定义，有</p>
<div class="arithmatex">\[
r_k = a_0 + \frac{1}{[a_1,a_2,\cdots, a_k]}= a_0 + \frac{Q_{k-1}(a_1, \cdots, a_k)}{P_{k-1}(a_1, \cdots, a_k)} = \frac{a_0 P_{k-1}(a_1, \dots, a_k) + Q_{k-1}(a_1, \cdots, a_k)}{P_{k-1}(a_1, \cdots, a_k)}.
\]</div>
<p>和上式比较，不妨设 <span class="arithmatex">\(Q_k(a_0, \cdots, a_k) = P_{k-1}(a_1, \cdots, a_k)\)</span>，就可以将渐近分数写作</p>
<div class="arithmatex">\[
r_k =  \frac{P_k(a_0, a_1, \cdots, a_k)}{P_{k-1}(a_1, \cdots, a_k)}
\]</div>
<p>且多项式 <span class="arithmatex">\(P_k\)</span> 有递推关系</p>
<div class="arithmatex">\[
P_k(a_0, \cdots, a_k) = a_0 P_{k-1}(a_1, \cdots, a_k) + P_{k-2}(a_2, \cdots, a_k).
\]</div>
<p>因为</p>
<div class="arithmatex">\[
r_0 = a_0,\ r_1 = a_0+\dfrac{1}{a_1} = \frac{a_0a_1+1}{a_1},
\]</div>
<p>所以，递推的起点是</p>
<div class="arithmatex">\[
P_0(a_0) = a_0,\ P_1(a_0,a_1) = a_0a_1 + 1.
\]</div>
<p>如果设</p>
<div class="arithmatex">\[
P_{-1} = 1,\ P_{-2} = 0,
\]</div>
<p>可以验证对于 <span class="arithmatex">\(k=0,1\)</span> 也成立上述递推关系。这相当于规定了形式分数 <span class="arithmatex">\(r_{-1}=\dfrac{1}{0}\)</span> 和 <span class="arithmatex">\(r_{-2}=\dfrac{0}{1}\)</span>。</p>
<p>满足上述递推关系的多项式列 <span class="arithmatex">\(P_k\)</span> 称为 <strong>连项式</strong><sup id="fnref:continuant"><a class="footnote-ref" href="#fn:continuant">2</a></sup>（continuant）。它可以写作行列式的形式：</p>
<div class="arithmatex">\[
P_k(a_0,\cdots,a_k)=\det
\begin{pmatrix}
a_0 &amp; 1 &amp; 0 &amp; \cdots &amp; 0 \\
-1 &amp; a_1 &amp; 1 &amp; \ddots &amp; \vdots \\
0 &amp; -1 &amp; a_2 &amp; \ddots &amp; 0 \\
\vdots &amp; \ddots &amp; \ddots &amp; \ddots &amp; 1 \\
0 &amp; \cdots &amp; 0 &amp; -1 &amp; a_k
\end{pmatrix}.
\]</div>
<p>这是一个 <a href="https://en.wikipedia.org/wiki/Tridiagonal_matrix">三对角矩阵</a> 的行列式，从左上角开始展开，可以验证它具有上面的递推关系和初值条件。反过来，从右下角开始展开，则又能得到递推关系</p>
<div class="arithmatex">\[
P_k(a_0, \cdots, a_k) = a_k P_{k-1}(a_0, \cdots, a_{k-1}) + P_{k-2}(a_0, \cdots, a_{k-2}),
\]</div>
<p>这就是所要求证的。</p>
</details>
<details class="info" open="open">
<summary>记号</summary>
<p>本文将渐近分数 <span class="arithmatex">\(x_k\)</span> 记作 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span> 时，总是默认分子 <span class="arithmatex">\(p_k\)</span> 和 <span class="arithmatex">\(q_k\)</span> 由上面的递推关系给出。下文还要说明，这样总能得到渐近分数的既约表示。</p>
</details>
<p data-original-document-end="6316" data-original-document-start="6309">这个递推式说明</p>
<div class="arithmatex">\[
x_k=\dfrac{a_kp_{k-1}+p_{k-2}}{a_kq_{k-1}+q_{k-2}}
\]</div>
<p data-original-document-end="6404" data-original-document-start="6376">介于 <span class="arithmatex">\(x_{k-1}\)</span> 和 <span class="arithmatex">\(x_{k-2}\)</span> 之间。</p>
<p data-original-document-end="6436" data-original-document-start="6406">作为渐近分数的递推关系的推论，成立如下的反序定理和倒数定理：</p>
<details class="note" data-original-document-end="6771" data-original-document-start="6438" open="open">
<summary>反序定理</summary>
<p>设实数 <span class="arithmatex">\(x=[a_0,a_1,a_2,\cdots]\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数是 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span>，则相邻两个渐近分数的分子和分母的比值分别为</p>
<div class="arithmatex">\[
\begin{aligned}
\frac{p_k}{p_{k-1}}&amp;=[a_k,a_{k-1},\cdots,a_1,a_0],\\
\frac{q_k}{q_{k-1}}&amp;=[a_k,a_{k-1},\cdots,a_1].
\end{aligned}
\]</div>
<p>如果 <span class="arithmatex">\(a_0=0\)</span>，则第一个连分数应当理解为在倒数第二项处截断，即 <span class="arithmatex">\([a_k,a_{k-1},\cdots,a_2]\)</span>。</p>
</details>
<details class="note" data-original-document-end="7300" data-original-document-start="7022">
<summary>证明</summary>
<p>在 <span class="arithmatex">\(p_k\)</span> 和 <span class="arithmatex">\(q_k\)</span> 的递推关系中，左右两侧分别同除以 <span class="arithmatex">\(p_{k-1}\)</span> 和 <span class="arithmatex">\(q_{k-1}\)</span>，就得到</p>
<div class="arithmatex">\[
\begin{aligned}
\frac{p_k}{p_{k-1}} &amp;= a_k + \frac{p_{k-2}}{p_{k-1}},\\
\frac{q_k}{q_{k-1}} &amp;= a_k + \frac{q_{k-2}}{q_{k-1}}.
\end{aligned}
\]</div>
<p>迭代这两个式子，就可以得到两个连分数。再代入初始值 <span class="arithmatex">\(\dfrac{p_0}{p_{-1}}=a_0\)</span> 和 <span class="arithmatex">\(\dfrac{q_1}{q_0}=a_1\)</span> 即可。至于 <span class="arithmatex">\(a_0=0\)</span> 的情形，将得到的连分数理解为形式表达式，则它的余项</p>
<div class="arithmatex">\[
[a_2,a_1,0]=a_2+\dfrac{1}{a_1+\dfrac{1}{0}}=a_2+\dfrac{0}{0a_1+1}=a_2.
\]</div>
<p>因而可以直接略去最后两项。如果需要严格的证明，只要注意到这个式子可以看作 <span class="arithmatex">\(a_0\rightarrow 0\)</span> 的极限即可。</p>
</details>
<details class="note" data-original-document-end="7357" data-original-document-start="7302" open="open">
<summary>倒数定理</summary>
<p>实数 <span class="arithmatex">\(x&gt;0\)</span> 的渐近分数的倒数是 <span class="arithmatex">\(x^{-1}\)</span> 的渐近分数。</p>
</details>
<details class="note">
<summary>证明</summary>
<p>不妨设 <span class="arithmatex">\(x&gt;1\)</span> 且有连分数表示 <span class="arithmatex">\([a_0,a_1,a_2,\cdots]\)</span>，则 <span class="arithmatex">\(x^{-1}\)</span> 的连分数表示是 <span class="arithmatex">\([0,a_0,a_1,a_2,\cdots]\)</span>。它们的渐近分数可以从递推关系中求得。而且，对于 <span class="arithmatex">\(x\)</span>，有初值条件 <span class="arithmatex">\(x_{-2}=\dfrac{0}{1}\)</span> 和 <span class="arithmatex">\(x_{-1}=\dfrac{1}{0}\)</span>；对于 <span class="arithmatex">\(y=x^{-1}\)</span>，有初值条件 <span class="arithmatex">\(y_{-1}=\dfrac{1}{0}\)</span> 和 <span class="arithmatex">\(y_{0}=\dfrac{0}{1}\)</span>。因此，有 <span class="arithmatex">\(x_{-2}=(y_{-1})^{-1}\)</span> 和 <span class="arithmatex">\(x_{-1}=(y_0)^{-1}\)</span>。根据递推关系，可以得到 <span class="arithmatex">\(x_k=y_{k+1}^{-1}\)</span>。这就说明，<span class="arithmatex">\(x\)</span> 的渐近分数的倒数是 <span class="arithmatex">\(y=x^{-1}\)</span> 的渐近分数。对于 <span class="arithmatex">\(0&lt;x\le 1\)</span> 的情形，也可以做类似讨论。</p>
</details>
<p data-original-document-end="7781" data-original-document-start="7753">利用本节得到的递推关系，可以得到计算渐近分数的算法如下：</p>
<details class="example" open="open">
<summary>参考实现</summary>
<p>给定连分数的系数 <span class="arithmatex">\(a_0,a_1,\cdots,a_n\)</span>，求渐近分数的分子和分母序列 <span class="arithmatex">\((p_0,q_0),(p_1,q_1),\cdots,(p_n,q_n)\)</span>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">C++</label><label for="__tabbed_2_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Find the convergents of a continued fraction A.</span>
<span class="c1">// Numerators and denominators stored separately in P and Q.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">convergents</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">()[</span><span class="mi">-2</span><span class="p">]);</span>
<span class="w">    </span><span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">()[</span><span class="mi">-2</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find the convergents of a continued fraction A.</span>
<span class="c1"># Numerators and denominators stored separately in P and Q.</span>
<span class="k">def</span> <span class="nf">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">it</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">it</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 data-original-document-end="8131" data-original-document-start="8123" id="误差估计">误差估计<a class="headerlink" href="#误差估计" title="Permanent link"></a></h3>
<p data-original-document-end="8164" data-original-document-start="8133">利用渐近分数的递推公式，可以估计用渐近分数逼近实数产生的误差。</p>
<p data-original-document-end="8184" data-original-document-start="8166">首先，可以计算相邻的渐近分数的差值：</p>
<details class="note" data-original-document-end="8335" data-original-document-start="8186" open="open">
<summary>渐近分数的差分</summary>
<p>设 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\)</span> 是实数 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数。那么，有</p>
<div class="arithmatex">\[
p_{k+1}q_k − p_kq_{k+1} = (−1)^k.
\]</div>
<p>因此，相邻两项的渐近分数的差分是</p>
<div class="arithmatex">\[
x_{k+1} - x_k = \dfrac{(-1)^k}{q_{k+1}q_k}.
\]</div>
</details>
<details class="note" data-original-document-end="9049" data-original-document-start="8962">
<summary>证明</summary>
<p>根据递推关系，有</p>
<div class="arithmatex">\[
\begin{aligned}
\det\begin{pmatrix}
p_{k+1} &amp; p_k \\
q_{k+1} &amp; q_k 
\end{pmatrix}
&amp;=
\det\begin{pmatrix}
a_{k+1}p_{k}+p_{k-1} &amp; p_k \\
a_{k+1}q_{k}+q_{k-1} &amp; q_k 
\end{pmatrix}
=
\det\begin{pmatrix}
p_{k-1} &amp; p_k\\
q_{k-1} &amp; q_k
\end{pmatrix}
\\
&amp;=
-
\det\begin{pmatrix}
p_k &amp; p_{k-1}\\
q_k &amp; q_{k-1}
\end{pmatrix}
=
(-1)^{k+2}
\det\begin{pmatrix}
1 &amp; 0\\
0 &amp; 1
\end{pmatrix}
=(-1)^k.
\end{aligned}
\]</div>
<p>这就是 <span class="arithmatex">\(p_{k+1}q_k − p_kq_{k+1} = (−1)^k\)</span>。对两边同除以 <span class="arithmatex">\(q_{k+1}q_k\)</span>，就得到关于 <span class="arithmatex">\(x_{k+1}-x_k\)</span> 的结论。</p>
</details>
<p data-original-document-end="9097" data-original-document-start="9051">因而，奇数项渐近分数总是大于相邻两项，偶数项渐近分数总是小于相邻两项：渐近分数是交错变化的。</p>
<p data-original-document-end="9134" data-original-document-start="9099">如果只看偶数项（奇数项）渐近分数，序列也是单调递增（递减）的。这是因为</p>
<div class="arithmatex">\[
x_{k+2}-x_k = \dfrac{(-1)^{k+1}}{q_{k+2}q_{k+1}}+\dfrac{(-1)^{k}}{q_{k+1}q_{k}} = \dfrac{(-1)^k(q_{k+2}-q_k)}{q_{k+2}q_{k+1}q_k} = \dfrac{(-1)^ka_{k+2}}{q_{k+2}q_k}
\]</div>
<p data-original-document-end="9483" data-original-document-start="9308">当 <span class="arithmatex">\(k\)</span> 为偶数（奇数）时为正（负）。同时，因为成立递推关系 <span class="arithmatex">\(q_{k}=a_kq_{k-1}+q_{k-2}\)</span>，分母 <span class="arithmatex">\(q_k\)</span> 的增长速度不会慢于斐波那契数列的速度。所以，相邻两项的差一定趋近于零。这就说明，偶数项和奇数项渐近分数分别自下而上和自上而下地逼近同一极限。这就证明了无限简单连分数一定收敛。渐近分数趋近于相应实数的动态可以见下图：</p>
<p data-original-document-end="9528" data-original-document-start="9485"><img alt="" src="../images/Golden_ration_convergents.svg" /></p>
<details class="abstract" data-original-document-end="9658" data-original-document-start="9530" open="open">
<summary>上（下）渐近分数</summary>
<p>对于实数 <span class="arithmatex">\(x\)</span> 和它的渐近分数 <span class="arithmatex">\(x_k\)</span>，如果 <span class="arithmatex">\(x_k&gt;x\)</span>（<span class="arithmatex">\(x_k&lt;x\)</span>），就称 <span class="arithmatex">\(x_k\)</span> 为 <span class="arithmatex">\(x\)</span> 的 <strong>上（下）渐近分数</strong>（upper (lower) convergent）。</p>
</details>
<p data-original-document-end="9697" data-original-document-start="9660">前面已经说明，上渐近分数就是奇数项渐近分数，下渐近分数就是偶数项渐近分数。</p>
<p data-original-document-end="9726" data-original-document-start="9699">利用差分公式，可以将实数 <span class="arithmatex">\(x\)</span> 写成交错级数的形式：</p>
<div class="arithmatex">\[
x = a_0+\sum_{k=0}^{\infty}\dfrac{(-1)^k}{q_{k+1}q_k}.
\]</div>
<p data-original-document-end="9817" data-original-document-start="9790">连分数定义中的渐近分数和余项就是该级数的部分和和余项。</p>
<p data-original-document-end="9850" data-original-document-start="9819">利用差分公式，还可以直接对渐近分数逼近实数产生的误差做出估计：</p>
<details class="note" data-original-document-end="10052" data-original-document-start="9852" open="open">
<summary>误差</summary>
<p>设 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\neq x\)</span> 是实数 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数。那么，有</p>
<div class="arithmatex">\[
x_k - x = \dfrac{(-1)^k}{q_k\left(r_{k+1}q_k+q_{k-1}\right)},
\]</div>
<p>其中，<span class="arithmatex">\(r_{k+1}\)</span> 是实数 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k+1\)</span> 个余项。进而，有</p>
<div class="arithmatex">\[
\dfrac{1}{2q_{k+1}^2} \le \dfrac{1}{q_k(q_k+q_{k+1})} \le \left|x-\frac{p_k}{q_k}\right| \le \dfrac{1}{q_kq_{k+1}} \le \dfrac{1}{q_k^2}.
\]</div>
</details>
<details class="note" data-original-document-end="10867" data-original-document-start="10369">
<summary>证明</summary>
<p>因为 <span class="arithmatex">\(x=[a_0,a_1,\cdots,a_k,r_{k+1}]\)</span>，而且对形式连分数也成立渐近分数的差分公式，所以有</p>
<div class="arithmatex">\[
x-x_k = \dfrac{(-1)^k}{q_k\left(r_{k+1}q_k+q_{k-1}\right)},
\]</div>
<p>其中，<span class="arithmatex">\(r_{k+1}q_k+q_{k-1}\)</span> 就是按照递推公式得到的这个形式连分数的第 <span class="arithmatex">\(k+1\)</span> 个渐近分数的分母。</p>
<p>要完成随后的不等式估计，只需要注意到当 <span class="arithmatex">\(x_k\neq x\)</span> 时，总成立</p>
<div class="arithmatex">\[
1\le a_{k+1}\le r_{k+1} \le a_{k+1}+1,
\]</div>
<p>所以有</p>
<div class="arithmatex">\[
q_{k+1}=a_{k+1}q_k+q_{k-1}\le r_{k+1}q_k+q_{k-1} \le q_k+(a_{k+1}q_k+q_{k-1}) = q_k+q_{k+1}.
\]</div>
<p>因此，有不等式</p>
<div class="arithmatex">\[
\dfrac{1}{q_k(q_k+q_{k+1})} \le \left|x-\frac{p_k}{q_k}\right| = \dfrac{1}{q_k\left(r_{k+1}q_k+q_{k-1}\right)} \le \dfrac{1}{q_kq_{k+1}}.
\]</div>
<p>要得到外侧的放缩，再注意到 <span class="arithmatex">\(q_k\le q_{k+1}\)</span> 就可以了。</p>
</details>
<p data-original-document-end="10915" data-original-document-start="10869">本节的差分公式还有一个简单推论：渐近分数 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span> 都是既约的。</p>
<details class="note" data-original-document-end="11037" data-original-document-start="10917" open="open">
<summary>推论</summary>
<p>对于任何实数 <span class="arithmatex">\(x\)</span>，且渐近分数 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\)</span> 的分子和分母由递推公式给出，则 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span> 是既约分数，即 <span class="arithmatex">\(\gcd(p_k,q_k)=1\)</span>。</p>
</details>
<details class="note">
<summary>证明</summary>
<p>对差分公式应用 <a href="../bezouts/">裴蜀定理</a> 即可。</p>
</details>
<p data-original-document-end="11115" data-original-document-start="11091">其实，线性同余方程的解可以通过连分数的方法求解。</p>
<details class="example" data-original-document-end="11217" data-original-document-start="11117" open="open">
<summary>线性同余方程的求解</summary>
<p>给定 <span class="arithmatex">\(A, B, C \in \mathbf Z\)</span>。查找 <span class="arithmatex">\(x, y \in \mathbf Z\)</span>，使得 <span class="arithmatex">\(Ax + By = C\)</span> 成立。</p>
</details>
<details class="note" data-original-document-end="11617" data-original-document-start="11219">
<summary>解答</summary>
<p>虽然这个问题通常是用 <a href="../linear-equation/#用扩展欧几里得算法求解">扩展欧几里得算法</a> 解决的，但是同样可以通过连分数求解。</p>
<p>设 <span class="arithmatex">\(\dfrac{A}{B}=[a_0, a_1, \cdots, a_k]\)</span>。上面证明了 <span class="arithmatex">\(p_k q_{k-1} - p_{k-1} q_k = (-1)^{k-1}\)</span>。将 <span class="arithmatex">\(p_k\)</span> 和 <span class="arithmatex">\(q_k\)</span> 替换为 <span class="arithmatex">\(A\)</span> 和 <span class="arithmatex">\(B\)</span>，得到</p>
<div class="arithmatex">\[
Aq_{k-1} - Bp_{k-1} = (-1)^{k-1} g,
\]</div>
<p>其中，<span class="arithmatex">\(g = \gcd(A, B)\)</span>。如果 <span class="arithmatex">\(g\)</span> 整除 <span class="arithmatex">\(C\)</span>，则一组解为 <span class="arithmatex">\(x = (-1)^{k-1}\dfrac{C}{g} q_{k-1}\)</span> 和 <span class="arithmatex">\(y = (-1)^{k}\dfrac{C}{g} p_{k-1}\)</span>；否则无解。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">C++</label><label for="__tabbed_3_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Return (x,y) such that Ax+By=C.</span>
<span class="c1">// Assume that such (x,y) exists.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">dio</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convergents</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">));</span>
<span class="w">  </span><span class="n">C</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">end</span><span class="p">()[</span><span class="mi">-2</span><span class="p">],</span><span class="w"> </span><span class="o">-</span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">()[</span><span class="mi">-2</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Return (x, y) such that Ax+By=C.</span>
<span class="c1"># Assume that such (x, y) exists.</span>
<span class="k">def</span> <span class="nf">dio</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
    <span class="n">C</span> <span class="o">//=</span> <span class="n">A</span> <span class="o">//</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># divide by gcd(A, B)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">t</span> <span class="o">*</span> <span class="n">C</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">C</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h2 data-original-document-end="11858" data-original-document-start="11850" id="丢番图逼近">丢番图逼近<a class="headerlink" href="#丢番图逼近" title="Permanent link"></a></h2>
<p data-original-document-end="12020" data-original-document-start="11860">连分数理论的一个重要应用就是丢番图逼近理论。丢番图逼近（Diophantine approximation）是指用有理数逼近实数。当然，由于有理数的稠密性，如果不加以限制，可以得到误差任意小的逼近。因此，需要对可以使用的有理数做出限制，比如只能选择分母小于某个值的有理数。本节就讨论了这种限制下的最佳逼近和连分数的关系。</p>
<h3 data-original-document-end="12035" data-original-document-start="12022" id="用渐近分数逼近实数">用渐近分数逼近实数<a class="headerlink" href="#用渐近分数逼近实数" title="Permanent link"></a></h3>
<p data-original-document-end="12061" data-original-document-start="12037">首先，利用渐近分数的误差估计，立刻得到如下结果：</p>
<details class="note" data-original-document-end="12205" data-original-document-start="12063" open="open">
<summary>定理（Dirichlet）</summary>
<p>对于无理数 <span class="arithmatex">\(x\)</span>，存在无穷多个既约分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 使得</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right| &lt; \dfrac{1}{q^2} 
\]</div>
<p>成立。</p>
</details>
<details class="note" data-original-document-end="12417" data-original-document-start="12356">
<summary>证明</summary>
<p>根据渐近分数的误差估计，对于无理数 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\)</span>，有</p>
<div class="arithmatex">\[
\left|x-\dfrac{p_k}{q_k}\right|\le\frac{1}{q_k^2}.
\]</div>
<p>检查误差公式的证明即可知，对于任一无理数 <span class="arithmatex">\(x\)</span>，取等条件并不成立。因此，它的所有渐近分数的分子和分母都满足要求。</p>
</details>
<p data-original-document-end="12624" data-original-document-start="12419">这个定理也可以看作是 <a href="https://en.wikipedia.org/wiki/Dirichlet%27s_approximation_theorem">Dirichlet 逼近定理</a> 的推论。这几乎已经是最好的结果了。不等式右侧分母中的指数 <span class="arithmatex">\(2\)</span> 已经不能再改进，但是常数上可以做得更好。Hurwitz 定理说明，不等式右侧可以缩小到 <span class="arithmatex">\(\dfrac{1}{\sqrt{5}q^2}\)</span>，且这是最好的界。</p>
<details class="note" data-original-document-end="12803" data-original-document-start="12766" open="open">
<summary>Hurwitz 定理</summary>
<p>对于无理数 <span class="arithmatex">\(x\)</span>，存在无穷多个既约分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 使得</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right| &lt; \dfrac{1}{\sqrt{5}q^2} 
\]</div>
<p>成立，而且不等式右侧的 <span class="arithmatex">\(\sqrt{5}\)</span> 不能换成更大的实数。</p>
</details>
<details class="note" data-original-document-end="14715" data-original-document-start="12805">
<summary>证明（Borel）</summary>
<p>Borel 实际上证明了，无理数 <span class="arithmatex">\(x\)</span> 的连续三个渐近分数中，必然有至少一个满足上述条件。因为渐近分数无穷多，且都是既约分数，那么 Hurwitz 定理的第一部分就必然成立。</p>
<p>反证法。不妨设存在无理数 <span class="arithmatex">\(x\)</span> 和它的渐近分数 <span class="arithmatex">\(x_{k-1},x_k,x_{k+1}\)</span>，使得</p>
<div class="arithmatex">\[
\left|x-\dfrac{p_{k-1}}{q_{k-1}}\right|\ge\dfrac{1}{\sqrt{5}q_{k-1}^2},\ 
\left|x-\dfrac{p_{k}}{q_{k}}\right|\ge\dfrac{1}{\sqrt{5}q_{k}^2},\ 
\left|x-\dfrac{p_{k+1}}{q_{k+1}}\right|\ge\dfrac{1}{\sqrt{5}q_{k+1}^2}
\]</div>
<p>成立。因为相邻的渐近分数必然位于 <span class="arithmatex">\(x\)</span> 两侧，所以由差分公式知</p>
<div class="arithmatex">\[
\dfrac{1}{q_{k-1}q_{k}}=\left|\dfrac{p_{k-1}}{q_{k-1}}-\dfrac{p_{k}}{q_{k}}\right|=\left|x-\dfrac{p_{k-1}}{q_{k-1}}\right|+\left|x-\dfrac{p_{k}}{q_{k}}\right|\ge\dfrac{1}{\sqrt{5}q_{k-1}^2}+\dfrac{1}{\sqrt{5}q_{k}^2}.
\]</div>
<p>它可以写成关于商 <span class="arithmatex">\(\dfrac{q_{k}}{q_{k-1}}\)</span> 的不等式</p>
<div class="arithmatex">\[
\dfrac{q_k}{q_{k-1}}+\dfrac{q_{k-1}}{q_k}\le\sqrt 5.
\]</div>
<p>因为左侧是有理数，右侧是无理数，等号必然无法取得。又因为 <span class="arithmatex">\(q_k\ge q_{k-1}\)</span>，所以可以解得</p>
<div class="arithmatex">\[
1\le \dfrac{q_{k}}{q_{k-1}} &lt; \dfrac{\sqrt{5}+1}{2}.
\]</div>
<p>同理，可以证明</p>
<div class="arithmatex">\[
1\le \dfrac{q_{k+1}}{q_{k}} &lt; \dfrac{\sqrt{5}+1}{2}.
\]</div>
<p>但是根据递推公式，并结合两式可知，</p>
<div class="arithmatex">\[
a_{k+1} = \frac{q_{k+1}}{q_k}-\frac{q_{k-1}}{q_k} &lt; \dfrac{\sqrt{5}+1}{2}-\dfrac{\sqrt{5}-1}{2} = 1
\]</div>
<p>这与简单连分数的定义矛盾。所以，Borel 的结论成立。</p>
<p>要说明这样得到的界是最好的，只需要找到 <span class="arithmatex">\(x\)</span> 使得对于任何 <span class="arithmatex">\(C&gt;\sqrt{5}\)</span>，都只存在有限多个既约分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 使得不等式</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right| &lt; \dfrac{1}{Cq^2} 
\]</div>
<p>成立。下面证明 <span class="arithmatex">\(\phi=\dfrac{\sqrt{5}+1}{2}\)</span> 就是这样的 <span class="arithmatex">\(x\)</span>。<sup id="fnref:sqrt5"><a class="footnote-ref" href="#fn:sqrt5">3</a></sup> </p>
<p>设 <span class="arithmatex">\(\phi'=\dfrac{-\sqrt{5}+1}{2}\)</span> 是 <span class="arithmatex">\(\phi\)</span> 的共轭根。它们都是方程 <span class="arithmatex">\(x^2-x-1=0\)</span> 的根。因而，对任意实数 <span class="arithmatex">\(x\)</span>，都有</p>
<div class="arithmatex">\[
x^2-x-1 = (x-\phi)(x-\phi').
\]</div>
<p>代入既约分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span>，就得到</p>
<div class="arithmatex">\[
\dfrac{1}{q^2}\le\frac{|p^2-pq-q^2|}{q^2}=\left|\dfrac{p}{q}-\phi\right|\left|\dfrac{p}{q}-\phi'\right|\le\left|\dfrac{p}{q}-\phi\right|\left(\left|\dfrac{p}{q}-\phi\right|+|\phi-\phi'|\right)&lt;\dfrac{1}{Cq^2}\left(\dfrac{1}{Cq^2}+\sqrt{5}\right).
\]</div>
<p>对于 <span class="arithmatex">\(C&gt;\sqrt{5}\)</span>，可以直接解出 <span class="arithmatex">\(q&lt;\sqrt{C(C-\sqrt{5})}\)</span>，因而不可能存在无穷多组解满足上述不等式。</p>
</details>
<p data-original-document-end="14785" data-original-document-start="14717">这些定理的证明说明，渐近分数提供了相当好的丢番图逼近。但是，这未必是最佳逼近。要讨论最佳逼近，需要说明逼近程度的度量。这常常有两种选择。</p>
<details class="warning" data-original-document-end="15099" data-original-document-start="14787" open="open">
<summary>可能存在最佳逼近相关结论不成立的情形</summary>
<p>接下来的两节，会叙述一些关于最佳逼近的结果。这些结果可能对个别无趣的情形并不成立。比如，最佳逼近的两类定义都要求严格不等号，但是对于半奇数 <span class="arithmatex">\(x=n+\dfrac12\)</span> 且 <span class="arithmatex">\(n\in\mathbf Z\)</span>，它的连分数的形式可以是 <span class="arithmatex">\([n,1,1]\)</span>。此时，它的前两个渐近分数 <span class="arithmatex">\(x_0=n\)</span> 和 <span class="arithmatex">\(x_1=n+1\)</span> 的分母都是 <span class="arithmatex">\(1\)</span>，而且到 <span class="arithmatex">\(x\)</span> 的距离是一样的。这说明，它们都不是最佳逼近。对于本节的结论的叙述，读者应当默认这样的情形已经排除在外。如果读者不关心最末尾的几个渐近分数，抑或是只关心无理数的逼近，那么不必理会这些额外的复杂情形。</p>
</details>
<h3 data-original-document-end="15117" data-original-document-start="15101" id="第一类最佳逼近中间分数">第一类最佳逼近：中间分数<a class="headerlink" href="#第一类最佳逼近中间分数" title="Permanent link"></a></h3>
<p data-original-document-end="15128" data-original-document-start="15119">第一类最佳逼近使用</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right|
\]</div>
<p data-original-document-end="15173" data-original-document-start="15165">衡量逼近的程度。</p>
<details class="abstract" data-original-document-end="15455" data-original-document-start="15175" open="open">
<summary>第一类最佳逼近</summary>
<p>对于实数 <span class="arithmatex">\(x\)</span> 和有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span>，如果对于任意的 <span class="arithmatex">\(\dfrac{p'}{q'}\neq \dfrac{p}{q}\)</span> 且 <span class="arithmatex">\(0&lt;q'\le q\)</span> 都有</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right|&lt;\left|x-\dfrac{p'}{q'}\right|,
\]</div>
<p>就称有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 是实数 <span class="arithmatex">\(x\)</span> 的 <strong>第一类最佳逼近</strong>（best approximation of the first kind）。</p>
</details>
<p data-original-document-end="15483" data-original-document-start="15457">第一类最佳逼近未必是渐近分数，而是一类更宽泛的分数。</p>
<details class="abstract" data-original-document-end="15840" data-original-document-start="15485" open="open">
<summary>中间分数</summary>
<p>设实数 <span class="arithmatex">\(x\)</span> 有渐近分数 <span class="arithmatex">\(x_{k+1}=[a_0,a_1,\cdots,a_k,a_{k+1}]\)</span>，且整数 <span class="arithmatex">\(t\)</span> 满足 <span class="arithmatex">\(0\le t\le a_{k+1}\)</span><sup id="fnref:semi-range"><a class="footnote-ref" href="#fn:semi-range">4</a></sup>，则分数 <span class="arithmatex">\(x_{k,t}=[a_0,a_1,\cdots,a_{k},t]\)</span> 称为 <span class="arithmatex">\(x\)</span> 的 <strong>中间分数</strong>（intermediate fraction）、<strong>半收敛子</strong>（semiconvergent）或 <strong>次渐近分数</strong>（secondary convergent）。<sup id="fnref:semiconvergent"><a class="footnote-ref" href="#fn:semiconvergent">5</a></sup></p>
<p>类似于渐近分数的情形，大于（小于）<span class="arithmatex">\(x\)</span> 的中间分数称为 <strong>上（下）中间分数</strong>（upper (lower) semiconvergent）。</p>
</details>
<p data-original-document-end="15857" data-original-document-start="15842">根据递推公式，中间分数可以写成</p>
<div class="arithmatex">\[
x_{k,t} = \frac{tp_{k}+p_{k-1}}{tq_{k}+q_{k-1}}.
\]</div>
<p data-original-document-end="16003" data-original-document-start="15915">它必然是既约分数，而且位于渐近分数 <span class="arithmatex">\(x_{k-1}\)</span> 和 <span class="arithmatex">\(x_{k+1}\)</span> 之间。随着 <span class="arithmatex">\(t\)</span> 增大，它也逐渐向 <span class="arithmatex">\(x_{k+1}\)</span> 靠拢：（以 <span class="arithmatex">\(k\)</span> 为偶数的情形为例）</p>
<div class="arithmatex">\[
x_{k-1} = x_{k,0} &lt; x_{k,1} &lt; x_{k,2} &lt; \cdots &lt; x_{k,a_{k+1}} = x_{k+1}.
\]</div>
<p data-original-document-end="16201" data-original-document-start="16086">因为渐近分数的分子和分母都是递增的，中间分数 <span class="arithmatex">\(x_{k,t}\)</span>（<span class="arithmatex">\(t\neq 0\)</span>）的分子和分母落在了 <span class="arithmatex">\(x_{k}\)</span> 和 <span class="arithmatex">\(x_{k+1}\)</span> 之间。如果将这些分数按照分母大小排列，中间分数就是位于相邻的渐近分数中间的一些分数。</p>
<p data-original-document-end="16242" data-original-document-start="16203">所有的第一类最佳逼近都是中间分数，但是并不是所有的中间分数都是第一类最佳逼近。</p>
<details class="note" data-original-document-end="16280" data-original-document-start="16244" open="open">
<summary>定理</summary>
<p>所有的第一类最佳逼近都是中间分数。</p>
</details>
<details class="note" data-original-document-end="17275" data-original-document-start="16502">
<summary>证明</summary>
<p>因为 <span class="arithmatex">\(a_0\le x\le a_0+1\)</span>，所以第一类最佳逼近必然位于 <span class="arithmatex">\(x_{1,0}=a_0\)</span> 与 <span class="arithmatex">\(x_{0,1}=a_0+1\)</span> 之间。所有中间分数从小到大可以排列成</p>
<div class="arithmatex">\[
x_{1,0}&lt;x_{1,1}&lt; \cdots &lt; x_{1,a_2}=x_{3,0}&lt;\ldots&lt;x&lt;\ldots&lt;x_{2,0}=x_{0,a_1}&lt;\cdots&lt;x_{0,1}.
\]</div>
<p>同阶的中间分数是连续出现的，而不同阶的中间分数之间又没有间隔。这意味着，任何位于 <span class="arithmatex">\(x_{1,0}=a_0\)</span> 与 <span class="arithmatex">\(x_{0,1}=a_0+1\)</span> 之间的有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 必然落在两个同阶的中间分数 <span class="arithmatex">\(x_{k,t}\)</span> 和 <span class="arithmatex">\(x_{k,t+1}\)</span> 之间。不妨设它不是中间分数且小于 <span class="arithmatex">\(x\)</span>，因而有</p>
<div class="arithmatex">\[
x_{k,t}&lt;\dfrac{p}{q}&lt;x_{k,t+1}&lt;x.
\]</div>
<p>此时，一方面有</p>
<div class="arithmatex">\[
\left|x_{k,t}-\dfrac{p}{q}\right| \le \left|x_{k,t}-x_{k,t+1}\right| = \dfrac{1}{((t+1)q_k+q_{k-1})(tq_k+q_{k-1})}.
\]</div>
<p>另一方面有</p>
<div class="arithmatex">\[
\left|x_{k,t}-\dfrac{p}{q}\right| = \dfrac{|q(tp_k+p_{k-1})-p((t+1)q_k+q_{k-1})|}{q(tq_k+q_{k-1})}\ge\dfrac{1}{q(tq_k+q_{k-1})}.
\]</div>
<p>因此，必然有</p>
<div class="arithmatex">\[
q&gt;(t+1)q_k+q_{k-1}.
\]</div>
<p>也就是说，有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 的分母一定大于 <span class="arithmatex">\(x_{k,t+1}\)</span> 的分母，但是它并不是更好的逼近：</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right|&gt;\left|x-x_{k,t+1}\right|
\]</div>
<p>因此，它不可能是第一类最佳逼近。这就说明，不是中间分数，就不是第一类最佳逼近；亦即所有第一类最佳逼近都是中间分数。</p>
</details>
<p data-original-document-end="17329" data-original-document-start="17277">反过来，并不能断言所有的中间分数都是第一类最佳逼近。但是，的确可以给出中间分数成为第一类最佳逼近的条件。</p>
<details class="note" open="open">
<summary>定理</summary>
<p>所有渐近分数都是第一类最佳逼近。除此之外，设 <span class="arithmatex">\(0&lt;t&lt;a_{k+1}\)</span>，则中间分数 <span class="arithmatex">\(x_{k,t}\)</span> 是第一类最佳逼近，当且仅当 <span class="arithmatex">\(t&gt;\dfrac{a_{k+1}}{2}\)</span> 或者 <span class="arithmatex">\(t=\dfrac{a_{k+1}}{2}\)</span> 且 <span class="arithmatex">\(r_{k+2}&gt;\dfrac{q_k}{q_{k-1}}\)</span>。</p>
</details>
<details class="note" data-original-document-end="18925" data-original-document-start="17572">
<summary>证明</summary>
<p>下面会证明，渐近分数都是第二类最佳逼近，因而必然是第一类最佳逼近。关键在于那些不是渐近分数的中间分数。</p>
<p>前文已经说过，中间分数 <span class="arithmatex">\(x_{k,t}\)</span> 的分母位于 <span class="arithmatex">\(x_k\)</span> 和 <span class="arithmatex">\(x_{k+1}\)</span> 之间，且随着 <span class="arithmatex">\(t\)</span> 的增加逐渐增大，但是 <span class="arithmatex">\(x_{k,t}\)</span> 却逐渐接近 <span class="arithmatex">\(x_{k+1}\)</span>，因而更接近 <span class="arithmatex">\(x\)</span>。以 <span class="arithmatex">\(x_{k,t}&lt;x\)</span> 为例，它与相邻的中间分数的相对位置关系满足：</p>
<div class="arithmatex">\[
x_{k-1} &lt; x_{k,t} &lt; x_{k+1} &lt; x &lt; x_{k}.
\]</div>
<p>因为 <span class="arithmatex">\(x_k\)</span> 的分母小于 <span class="arithmatex">\(x_{k,t}\)</span>，所以 <span class="arithmatex">\(x_{k,t}\)</span> 成为第一类最佳逼近的必要条件就是，它比 <span class="arithmatex">\(x_k\)</span> 更接近 <span class="arithmatex">\(x\)</span>。这也是充分条件，因为作为渐近分数，没有比 <span class="arithmatex">\(x_k\)</span> 分母更小但是距离更近的了，而那些比 <span class="arithmatex">\(x_k\)</span> 分母还要大的中间分数，必然与 <span class="arithmatex">\(x_{k,t}\)</span> 同阶，但是分母更小，就必然距离 <span class="arithmatex">\(x\)</span> 更远。对于渐近分数和中间分数的误差，经计算可知</p>
<div class="arithmatex">\[
\begin{aligned}
\left|x_k-x\right| &amp;= \dfrac{1}{q_k(r_{k+1}q_k+q_{k-1})},\\
\left|x_{k,t}-x\right| &amp;= \left|\dfrac{tp_{k}+p_{k-1}}{tq_{k}+q_{k-1}}-\dfrac{r_{k+1}p_{k}+p_{k-1}}{r_{k+1}q_{k}+q_{k-1}}\right| \\
&amp;=\dfrac{r_{k+1}-t}{(tq_{k}+q_{k-1})(r_{k+1}q_{k}+q_{k-1})}.
\end{aligned}
\]</div>
<p>其中用到了 <span class="arithmatex">\(r_{k+1}\ge a_{k+1}&gt;t\)</span>。因此，<span class="arithmatex">\(x_{k,t}\)</span> 比 <span class="arithmatex">\(x_k\)</span> 更接近 <span class="arithmatex">\(x\)</span>，成为第一类最佳逼近，当且仅当 </p>
<div class="arithmatex">\[
\dfrac{r_{k+1}-t}{tq_{k}+q_{k-1}}&lt;\dfrac{1}{q_k} \iff r_{k+1}&lt;2t+\dfrac{q_{k-1}}{q_k}.
\]</div>
<p>此时，有三种可能的情况：</p>
<ol>
<li>如果 <span class="arithmatex">\(t&lt;\dfrac{a_{t+1}}{2}\)</span>，那么 <span class="arithmatex">\(2t&lt;a_{t+1}\)</span>。因为两侧都是整数，所以 <span class="arithmatex">\(2t\le a_{k+1}-1\)</span>，故而 <span class="arithmatex">\(2t+\dfrac{q_{k-1}}{q_k}\le 2t+1\le a_{k+1}\le r_{t+1}\)</span>。此时，<span class="arithmatex">\(x_{k,t}\)</span> 不是第一类最佳逼近；</li>
<li>如果 <span class="arithmatex">\(t&gt;\dfrac{a_{t+1}}{2}\)</span>，那么 <span class="arithmatex">\(2t&gt;a_{t+1}\)</span>。因为两侧都是整数，所以 <span class="arithmatex">\(2t\ge a_{t+1}+1&gt;r_{t+1}\)</span>。此时，<span class="arithmatex">\(x_{k,t}\)</span> 是第一类最佳逼近；</li>
<li>如果 <span class="arithmatex">\(a_{t+1}\)</span> 是偶数，还有第三种情况，即 <span class="arithmatex">\(t=\dfrac{a_{t+1}}{2}\)</span>。上述条件等价于 <span class="arithmatex">\(\dfrac{1}{r_{k+1}}=r_{k+1}-a_{k+1}&lt;\dfrac{q_{k-1}}{q_k}\)</span>，亦即 <span class="arithmatex">\(r_{k+2}&gt;\dfrac{q_k}{q_{k-1}}\)</span>。</li>
</ol>
</details>
<p data-original-document-end="19063" data-original-document-start="18927">所以，如果将实数 <span class="arithmatex">\(x\)</span> 的所有第一类最佳逼近按照分母自小到大的顺序排列，那么它会根据与 <span class="arithmatex">\(x\)</span> 的大小关系分成若干段。每一段总是由若干个（可以是零个）连续的同阶的中间分数组成，且总以渐近分数结尾。段内总能保持在实数 <span class="arithmatex">\(x\)</span> 的一侧，段与段之间则交错排列在 <span class="arithmatex">\(x\)</span> 两侧。</p>
<details class="example" data-original-document-end="19162" data-original-document-start="19065">
<summary> 例子：圆周率 <span class="arithmatex">\(\pi\)</span> 的第一类最佳逼近 </summary>
<p>圆周率 <span class="arithmatex">\(\pi=[3,7,15,1,292,\cdots]\)</span>，因而它分母最小的前 15 个第一类最佳逼近是：</p>
<div class="arithmatex">\[
\begin{aligned}
&amp;x_0 = \dfrac{3}{1},\
x_{0,4} = \dfrac{13}{4},\
x_{0,5} = \dfrac{16}{5},\
x_{0,6} = \dfrac{19}{6},\
x_1 = \dfrac{22}{7},\\
&amp;x_{1,8} = \dfrac{179}{57},\
x_{1,9} = \dfrac{201}{64},\
x_{1,10} = \dfrac{223}{71},\
x_{1,11} = \dfrac{245}{78},\
x_{1,12} = \dfrac{267}{85},\\
&amp;x_{1,13} = \dfrac{289}{92},
x_{1,14} = \dfrac{311}{99},\
x_2 = \dfrac{333}{106},\
x_3 = \dfrac{355}{113},\
x_{3,146} = \dfrac{52163}{16604}.
\end{aligned}
\]</div>
</details>
<h3 data-original-document-end="19698" data-original-document-start="19687" id="第二类最佳逼近">第二类最佳逼近<a class="headerlink" href="#第二类最佳逼近" title="Permanent link"></a></h3>
<p>第二类最佳逼近使用 <span class="arithmatex">\(|qx-p|\)</span> 来衡量逼近的程度。</p>
<details class="abstract" data-original-document-end="19991" data-original-document-start="19905" open="open">
<summary>第二类最佳逼近</summary>
<p>对于实数 <span class="arithmatex">\(x\)</span> 和有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span>，如果对于任意的 <span class="arithmatex">\(\dfrac{p'}{q'}\neq \dfrac{p}{q}\)</span> 且 <span class="arithmatex">\(0&lt;q'\le q\)</span> 都有</p>
<div class="arithmatex">\[
\left|qx-p\right|&lt;\left|q'x-p'\right|,
\]</div>
<p>就称有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 是实数 <span class="arithmatex">\(x\)</span> 的 <strong>第二类最佳逼近</strong>（best approximation of the second kind）。</p>
</details>
<p data-original-document-end="20006" data-original-document-start="19993">第二类最佳逼近的条件等价于</p>
<div class="arithmatex">\[
\left|x-\dfrac{p}{q}\right|&lt;\dfrac{q'}{q}\left|x-\dfrac{p'}{q'}\right|.
\]</div>
<p data-original-document-end="20125" data-original-document-start="20087">因为 <span class="arithmatex">\(q'\le q\)</span>，所以第二类最佳逼近的条件比第一类最佳逼近更为严苛。</p>
<p data-original-document-end="20144" data-original-document-start="20127">第二类最佳逼近能且仅能是渐近分数。</p>
<details class="note" open="open">
<summary>定理</summary>
<p>所有的第二类最佳逼近一定是渐近分数，所有的渐近分数也一定是第二类最佳逼近。</p>
</details>
<details class="note" data-original-document-end="21772" data-original-document-start="20601">
<summary>证明</summary>
<p>要证明第一部分，因为第二类最佳逼近也一定是第一类最佳逼近，所以只需要证明不是渐近分数的中间分数不能成为第二类最佳逼近就可以了。为此，设 <span class="arithmatex">\(x_{k,t}=\dfrac{p}{q}\)</span> 是中间分数但是不是渐近分数，那么，设 <span class="arithmatex">\(x_{k,t}&lt;x\)</span>，有</p>
<div class="arithmatex">\[
x_{k-1} &lt; x_{k,t} &lt; x_{k+1} &lt; x &lt; x_{k}.
\]</div>
<p>因为 <span class="arithmatex">\(x_{k,t}\)</span> 与 <span class="arithmatex">\(x\)</span> 之间的误差</p>
<div class="arithmatex">\[
|x_{k,t}-x|\ge |x_{k,t}-x_{k+1}|=\left|\dfrac{p}{q}-\dfrac{p_{k+1}}{q_{k+1}}\right|=\dfrac{|pq_{k+1}-p_{k+1}q|}{qq_{k+1}}\ge\dfrac{1}{qq_{k+1}},
\]</div>
<p>并利用渐近分数的误差估计，所以总是有</p>
<div class="arithmatex">\[
|qx_{k,t}-p| \ge \dfrac{1}{q_{k+1}} \ge |q_kx_k-p_k|,
\]</div>
<p>即 <span class="arithmatex">\(x_{k,t}\)</span> 的逼近程度不优于分母更小的 <span class="arithmatex">\(x_k\)</span> 逼近程度，所以不可能是第二类最佳逼近。</p>
<p>反过来，要证明第二部分，即每个渐近分数 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\)</span> 都是第二类最佳逼近。这就是要说明，对于所有分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 且 <span class="arithmatex">\(q\le q_k\)</span>，都有 <span class="arithmatex">\(|q_kx-p_k|&lt;|qx-p|\)</span>。不考虑半奇数的情形，则可以假定 <span class="arithmatex">\(k&gt;0\)</span>。首先，根据渐近分数逼近实数的误差估计，有 </p>
<div class="arithmatex">\[
|q_{k-1} x-p_{k-1}| \ge \frac{1}{q_{k-1}+q_{k}} \ge \dfrac{1}{q_{k+1}}\ge |q_kx-p_k|.
\]</div>
<p>不等式全部成立等号，当且仅当 <span class="arithmatex">\(a_{k+1}=1\)</span> 且是连分数的末项。不考虑这样的情形，那么 <span class="arithmatex">\(x_{k-1}=\dfrac{p_{k-1}}{q_{k-1}}\)</span> 严格劣于 <span class="arithmatex">\(x_k=\dfrac{p_k}{q_k}\)</span>。</p>
<p>任取一分数 <span class="arithmatex">\(\dfrac{p}{q}\neq x_k\)</span> 且 <span class="arithmatex">\(0&lt;q\le q_k\)</span>，因为有差分公式 <span class="arithmatex">\(p_{k}q_{k-1} − p_{k-1}q_{k} = (−1)^{k-1}\)</span>，所以由 Cramer 法则可知，线性方程组</p>
<div class="arithmatex">\[
\begin{cases}
\lambda p_k+\mu p_{k-1} = p,\\
\lambda q_k+\mu q_{k-1} = q
\end{cases}
\]</div>
<p>必然存在唯一的整数解 <span class="arithmatex">\((\lambda,\mu)\)</span>。如果 <span class="arithmatex">\(\lambda\mu&gt;0\)</span>，那么 <span class="arithmatex">\(q&gt;|\lambda|q_k\ge q_k\)</span>，矛盾。否则，<span class="arithmatex">\(\lambda\mu\le 0\)</span>，即 <span class="arithmatex">\(\lambda\)</span> 和 <span class="arithmatex">\(\mu\)</span> 异号，那么因为 <span class="arithmatex">\(q_{k-1}x-p_{k-1}\)</span> 和 <span class="arithmatex">\(q_kx-p_k\)</span> 也异号，就有 <span class="arithmatex">\(\lambda(q_{k-1}x-p_{k-1})\)</span> 和 <span class="arithmatex">\(\mu(q_kx-p_k)\)</span> 同号，故而</p>
<div class="arithmatex">\[
|qx-p|=|\lambda||q_kx-p_k|+|\mu||q_{k-1}x-p_{k-1}|&gt;|q_{k}x-p_{k}|.
\]</div>
<p>最后的不等号是严格的，因为 <span class="arithmatex">\(x_{k-1}\)</span> 严格劣于 <span class="arithmatex">\(x_k\)</span>，且 <span class="arithmatex">\(\dfrac{p}{q}\neq x_k\)</span>。这就说明，<span class="arithmatex">\(x_k\)</span> 是第二类最佳逼近。</p>
</details>
<p data-original-document-end="21798" data-original-document-start="21774">这个性质表明，渐近分数确实是相当好的丢番图逼近。</p>
<h3 id="渐近分数的判定">渐近分数的判定<a class="headerlink" href="#渐近分数的判定" title="Permanent link"></a></h3>
<p data-original-document-end="21992" data-original-document-start="21813">第二类最佳逼近提供了判断某个分数是否是渐近分数的充分必要条件。这说明，可以通过检查某个分数逼近的相对程度来判断它是否是渐近分数。Legendre 判别法则提供了根据逼近的绝对程度来判断渐近分数的方法。Legendre 判别法的原始表述提供了充分必要条件，但是它的形式并不实用。本节提供了 Legendre 判别法的简化版本，并说明它并没有漏掉太多的渐近分数。</p>
<details class="note" data-original-document-end="22155" data-original-document-start="21994" open="open">
<summary>定理（Legendre）</summary>
<p>对于实数 <span class="arithmatex">\(x\)</span> 与分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span>，如果有</p>
<div class="arithmatex">\[
\left|x−\dfrac{p}{q}\right|&lt;\dfrac{1}{2q^2}
\]</div>
<p>那么 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 一定是 <span class="arithmatex">\(x\)</span> 的渐近分数。</p>
</details>
<details class="note" data-original-document-end="23190" data-original-document-start="22289">
<summary>证明</summary>
<p>设 <span class="arithmatex">\(\epsilon\in\{-1,1\}\)</span> 和 <span class="arithmatex">\(\theta\in(0,1/2)\)</span> 是使得</p>
<div class="arithmatex">\[
x−\dfrac{p}{q} = \dfrac{\epsilon\theta}{q^2}
\]</div>
<p>成立的常数。将有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 展开成连分数 <span class="arithmatex">\([a_0,a_1,\cdots,a_n]\)</span>。此处，有理数有两种连分数表示，其中的 <span class="arithmatex">\(n\)</span> 恰好相差一，所以可以取连分数表示使得 <span class="arithmatex">\((-1)^n=\epsilon\)</span>，并记这个连分数表示的渐近分数为 <span class="arithmatex">\(\dfrac{p_k}{q_k}\)</span>。设实数 <span class="arithmatex">\(\omega\)</span> 满足</p>
<div class="arithmatex">\[
x = \dfrac{\omega p_n+p_{n-1}}{\omega q_n+q_{n-1}}.
\]</div>
<p>那么，必然有</p>
<div class="arithmatex">\[
\dfrac{\epsilon\theta}{q^2} = x−\dfrac{p}{q} = x-\dfrac{p_n}{q_n} = \dfrac{p_{n-1}q_n-p_nq_{n-1}}{(\omega q_n+q_{n-1})q_n} = \dfrac{(-1)^n}{(\omega q_n+q_{n-1})q_n}.
\]</div>
<p>故而，有</p>
<div class="arithmatex">\[
\theta = \dfrac{q_n}{\omega q_n+q_{n-1}}.
\]</div>
<p>这说明</p>
<div class="arithmatex">\[
\omega=\dfrac{1}{\theta}-\dfrac{q_{n-1}}{q_n}&gt;1.
\]</div>
<p>将 <span class="arithmatex">\(\omega\)</span> 也展成连分数 <span class="arithmatex">\([b_0,b_1,\cdots]\)</span>，则</p>
<div class="arithmatex">\[
x = \dfrac{\omega p_n+p_{n-1}}{\omega q_n+q_{n-1}} = [a_0,a_1,\cdots,a_n,\omega] = [a_0,a_1,\cdots,a_n,b_0,b_1,\cdots].
\]</div>
<p>这是合法的简单连分数，所以 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 就是 <span class="arithmatex">\(x\)</span> 的渐近分数。</p>
<p>这个证明实际说明 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 成为渐近分数的充分必要条件是上述证明中的 <span class="arithmatex">\(\omega&gt;1\)</span>，这正是 Legendre 判别法的原始形式。</p>
</details>
<p data-original-document-end="23258" data-original-document-start="23192">这个判别法说明，只要逼近的程度足够好，就一定是渐近分数。下一个定理说明，这样好的渐近分数足够多：至少有一半的渐近分数都符合这个条件。</p>
<details class="note" data-original-document-end="23311" data-original-document-start="23260" open="open">
<summary>定理（Valhen）</summary>
<p>实数 <span class="arithmatex">\(x\)</span> 的相邻两个渐近分数中至少有一个满足</p>
<div class="arithmatex">\[
\left|x−\dfrac{p}{q}\right|&lt;\dfrac{1}{2q^2}.
\]</div>
</details>
<details class="note">
<summary>证明</summary>
<p>假设不然。存在实数 <span class="arithmatex">\(x\)</span> 有两个相邻的渐近分数 <span class="arithmatex">\(x_{k-1}\)</span> 和 <span class="arithmatex">\(x_k\)</span> 满足</p>
<div class="arithmatex">\[
\left|x-\dfrac{p_k}{q_k}\right|\ge \dfrac{1}{2q_{k}^2},\ \left|x-\dfrac{p_{k+1}}{q_{k+1}}\right|\ge \dfrac{1}{2q_{k+1}^2}.
\]</div>
<p>因为 <span class="arithmatex">\(x\)</span> 位于 <span class="arithmatex">\(x_{k-1}\)</span> 和 <span class="arithmatex">\(x_k\)</span> 之间，所以</p>
<div class="arithmatex">\[
\dfrac{1}{2q_{k}^2} + \dfrac{1}{2q_{k+1}^2} \le \left|x-\dfrac{p_k}{q_k}\right| + \left|x-\dfrac{p_{k+1}}{q_{k+1}}\right| = \left|\dfrac{p_k}{q_k}-\dfrac{p_{k+1}}{q_{k+1}}\right| = \dfrac{1}{q_kq_{k+1}}.
\]</div>
<p>这说明 <span class="arithmatex">\(q_k=q_{k+1}\)</span>。故而必然有 <span class="arithmatex">\(k=0\)</span> 且 <span class="arithmatex">\(a_1=1\)</span>。此时前两个渐近分数是 <span class="arithmatex">\(x_0=a_0\)</span> 和 <span class="arithmatex">\(x_1=a_0+1\)</span>。故而命题的唯一反例是半奇数，按照前文的说明，本文不考虑这种情形。</p>
</details>
<h2 data-original-document-end="23966" data-original-document-start="23959" id="几何解释">几何解释<a class="headerlink" href="#几何解释" title="Permanent link"></a></h2>
<p data-original-document-end="23983" data-original-document-start="23968">连分数理论有着优美的几何解释。</p>
<p data-original-document-end="24033" data-original-document-start="23985"><img alt="" src="../images/Continued_convergents_geometry.svg" /></p>
<p data-original-document-end="24298" data-original-document-start="24035">如图所示，对于实数 <span class="arithmatex">\(\xi&gt;0\)</span>，直线 <span class="arithmatex">\(y=\xi x\)</span> 将第一象限（包括 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 坐标轴上的点但不包括原点，下同）上的整点（lattice point）分成上下两部分。对于有理数 <span class="arithmatex">\(\xi\)</span> 的情形，直线 <span class="arithmatex">\(y=\xi x\)</span> 上的点既算作直线上方的点，又算作直线下方的点。考虑这两部分的点的凸包。那么，奇数项渐近分数是上半部分的凸包的顶点，偶数项渐进分数是下半部分的凸包的顶点。凸包上两个相邻顶点之间的连线上的整点就是中间分数。图中展示了 <span class="arithmatex">\(\xi=\dfrac{9}{7}\)</span> 的渐近分数和中间分数（灰点）。</p>
<p data-original-document-end="24323" data-original-document-start="24300">前文关于连分数的大部分结论都有相应的几何解释：</p>
<details class="note" data-original-document-end="28164" data-original-document-start="24795">
<summary>几何解释</summary>
<ul>
<li>
<p>每个分数 <span class="arithmatex">\(\nu=\dfrac{p}{q}\)</span> 都对应着第一象限内的一个整点 <span class="arithmatex">\(\vec\nu=(q,p)\)</span>，分数的大小对应着与原点连线的斜率。</p>
</li>
<li>
<p>直线 <span class="arithmatex">\(y=\xi x\)</span> 的方向向量是 <span class="arithmatex">\(\vec\xi=(1,\xi)\)</span>。利用 <a href="../../linear-algebra/product/#二维向量的情形">叉积</a> <span class="arithmatex">\((x_1,y_1)\times(x_2,y_2)=x_1y_2-x_2y_1\)</span> 的概念，可以通过 <span class="arithmatex">\(\vec\xi\times\vec\nu=p-q\xi\)</span> 的正负判断点在直线上方还是下方。因而，在直线上方的点就对应着大于等于 <span class="arithmatex">\(\xi\)</span> 的分数，在直线下方的点就对应着小于等于 <span class="arithmatex">\(\xi\)</span> 的分数。叉积的绝对值 <span class="arithmatex">\(|\vec\xi\times\vec\nu|\)</span> 正比于点 <span class="arithmatex">\(\vec\nu\)</span> 与直线 <span class="arithmatex">\(y=\xi x\)</span> 的距离</p>
<div class="arithmatex">\[
\dfrac{|p-qx|}{\sqrt{1+\xi^2}},
\]</div>
<p>对应着分数 <span class="arithmatex">\(\nu\)</span> 对实数 <span class="arithmatex">\(\xi\)</span> 的逼近程度。</p>
</li>
<li>
<p>将渐近分数 <span class="arithmatex">\(\xi_k=\dfrac{p_k}{q_k}\)</span> 对应的点记作 <span class="arithmatex">\(\vec\xi_k=(p_k,q_k)\)</span>，则递推公式就可以写作</p>
<div class="arithmatex">\[
\vec\xi_k = a_k\vec\xi_{k-1} + \vec\xi_{k-2}.
\]</div>
<p>递归的起点是 <span class="arithmatex">\(\xi_{-2} = (1,0)\)</span> 和 <span class="arithmatex">\(\xi_{-1} = (0,1)\)</span>。</p>
</li>
<li>
<p>对于整数 <span class="arithmatex">\(t\)</span>，如果 <span class="arithmatex">\(0\le t\le a_k\)</span>，那么点</p>
<div class="arithmatex">\[
\vec\xi_{k-1,t} = t\vec\xi_{k-1} + \vec\xi_{k-2}
\]</div>
<p>就落在连结点 <span class="arithmatex">\(\vec\xi_{k-2}\)</span> 和点 <span class="arithmatex">\(\vec\xi_k\)</span> 的线段上。它们对应着中间分数 <span class="arithmatex">\(\xi_{k-1,t}\)</span>。</p>
</li>
<li>
<p>利用几何的方法可以构造出所有的渐近分数和中间分数。从点 <span class="arithmatex">\(\vec\xi_{-2}=(1,0)\)</span> 和点 <span class="arithmatex">\(\vec\xi_{-1}=(0,1)\)</span> 开始，两个点位于直线 <span class="arithmatex">\(y=\xi x\)</span> 两侧，这意味着 <span class="arithmatex">\(\vec\xi\times\vec\xi_{-2}\)</span> 和 <span class="arithmatex">\(\vec\xi\times\vec\xi_{-1}\)</span> 符号相反。将 <span class="arithmatex">\(\vec\xi_{-1}\)</span> 按照向量的加法添加到 <span class="arithmatex">\(\vec\xi_{-2}\)</span> 上，直到无法继续添加而不穿过直线 <span class="arithmatex">\(y=\xi x\)</span> 为止，将结果记作 <span class="arithmatex">\(\vec\xi_0\)</span>，此时仍与 <span class="arithmatex">\(\vec\xi_{-1}\)</span> 不同侧。再将 <span class="arithmatex">\(\vec\xi_0\)</span> 添加到 <span class="arithmatex">\(\vec\xi_{-1}\)</span> 上，直到无法继续添加而不穿过直线 <span class="arithmatex">\(y=\xi x\)</span> 为止，将结果记作 <span class="arithmatex">\(\vec\xi_1\)</span>，此时仍与 <span class="arithmatex">\(\vec\xi_0\)</span> 不同侧。这个过程可以一直持续到无穷，除非在有限步内某个 <span class="arithmatex">\(\vec\xi_n\)</span> 就恰好落在直线 <span class="arithmatex">\(y=\xi x\)</span> 上。后者意味着向量 <span class="arithmatex">\(\vec\xi\)</span> 与 <span class="arithmatex">\(\vec\xi_n\)</span> 共线，即 <span class="arithmatex">\(\xi=\dfrac{p_n}{q_n}\)</span> 为有理点。这个过程就可以得到前面示意图中的图形。Boris Delaunay 将这个过程形象地称为鼻子拉伸算法（nose-streching algorithm）<sup id="fnref:nose-streching"><a class="footnote-ref" href="#fn:nose-streching">6</a></sup>。</p>
</li>
<li>
<p>如果需要快速计算每一步将 <span class="arithmatex">\(\vec\xi_{k-1}\)</span> 添加到 <span class="arithmatex">\(\vec\xi_{k-2}\)</span> 需要的次数，可以借助叉积。因为 <span class="arithmatex">\(\vec\xi\times\vec\xi_{k-1}\)</span> 与 <span class="arithmatex">\(\vec\xi\times\vec\xi_{k-2}\)</span> 符号相反，所以如果记 <span class="arithmatex">\(\vec\xi_{k-1,t}=t\vec\xi_{k-1}+\vec\xi_{k-2}\)</span> 为向 <span class="arithmatex">\(\vec\xi_{k-2}\)</span> 添加 <span class="arithmatex">\(t\)</span> 次 <span class="arithmatex">\(\vec\xi_{k-1}\)</span> 得到的结果，则 <span class="arithmatex">\(\vec\xi\times\vec\xi_{k-1,t}=t(\vec\xi\times\vec\xi_{k-1})+(\vec\xi\times\vec\xi_{k-2})\)</span> 不改变符号，就意味着没有穿过直线。在不变号之前，<span class="arithmatex">\(\vec\xi\times\vec\xi_{k-1,t}\)</span> 的绝对值会逐渐下降。记</p>
<div class="arithmatex">\[
r_{k} = \left|\dfrac{\vec\xi\times\vec\xi_{k-2}}{\vec\xi\times\vec\xi_{k-1}}\right| = -\dfrac{\vec\xi\times\vec\xi_{k-2}}{\vec\xi\times\vec\xi_{k-1}}.
\]</div>
<p>那么，最大可以下降的次数就是</p>
<div class="arithmatex">\[
a_{k} = \lfloor r_{k}\rfloor = \left\lfloor\left|\dfrac{q_{k-1}\xi-p_{k-1}}{q_{k-2}\xi-p_{k-2}}\right|\right\rfloor.
\]</div>
<p>这就是连分数展开的第 <span class="arithmatex">\(k\)</span> 项。而且，<span class="arithmatex">\(r_k\)</span> 就是连分数展开的余项，它满足关系式：</p>
<div class="arithmatex">\[
r_k = -\dfrac{q_{k-1}\xi-p_{k-1}}{q_{k-2}\xi-p_{k-2}} \iff \xi = \dfrac{p_{k-1}r_k + p_{k-2}}{q_{k-1}r_k+q_{k-2}}.
\]</div>
<p>这就是连分数关系式 <span class="arithmatex">\(\xi = [a_0,a_1,\cdots,a_{k-1},r_k]\)</span>。</p>
</li>
<li>
<p>因为每次添加向量造成的 <span class="arithmatex">\(\vec\xi\times\vec\xi_{k-1,t}\)</span> 的变化的步长都是 <span class="arithmatex">\(|\vec\xi\times\vec\xi_{k-1}|\)</span>，所以最后剩余的距离 <span class="arithmatex">\(|\vec\xi\times\vec\xi_k|\)</span> 必然严格小于 <span class="arithmatex">\(|\vec\xi\times\vec\xi_{k-1}|\)</span>。这说明，渐近分数的逼近程度（由 <span class="arithmatex">\(|qx-p|\)</span> 衡量）是随着 <span class="arithmatex">\(k\)</span> 的增加严格更优的。</p>
</li>
<li>
<p>利用叉积的运算法则，有</p>
<div class="arithmatex">\[
\vec\xi_{k}\times\vec\xi_{k+1} = \vec\xi_{k}\times(a_{k+1}\vec\xi_k+\vec\xi_{k-1}) = \vec\xi_{k}\times\vec\xi_{k-1} = -\vec\xi_{k-1}\times\vec\xi_{k}.
\]</div>
<p>归纳可知</p>
<div class="arithmatex">\[
\vec\xi_{k}\times\vec\xi_{k+1} = (-1)^{k+2}\vec\xi_{k-2}\times\vec\xi_{k-1} = (-1)^{k}.
\]</div>
<p>这就是渐近分数的差分公式 <span class="arithmatex">\(p_{k+1}q_k-p_kq_{k+1}=(-1)^k\)</span>。</p>
</li>
<li>
<p>上下两个凸包之间的面积可以剖分成若干个（可能是无穷多个）三角形，其中每个三角形的顶点分别是 <span class="arithmatex">\(\vec\xi_{k-2}\)</span>、<span class="arithmatex">\(\vec\xi_k\)</span> 和 <span class="arithmatex">\(\vec 0\)</span>。这样的三角形的面积是</p>
<div class="arithmatex">\[
\dfrac12|\vec\xi_{k-2}\times\vec\xi_k| = \dfrac12|\vec\xi_{k-2}\times(a_k\vec\xi_{k-1}+\vec\xi_{k-2})| = \dfrac{a_k}{2}|\vec\xi_{k-2}\times\vec\xi_{k-1}| = \dfrac{a_k}{2}.
\]</div>
<p>根据 <a href="../../geometry/pick.md">Pick 定理</a>，这意味着如果设 <span class="arithmatex">\(I\)</span> 和 <span class="arithmatex">\(B\)</span> 分别为三角形内部和边界上的整点个数，则</p>
<div class="arithmatex">\[
I + \dfrac{B}{2} - 1 = \dfrac{a_k}{2}.
\]</div>
<p>又已知三角形边界上已经有了 <span class="arithmatex">\(\{\vec 0\}\cup\{\vec\xi_{k-1,t}:0\le t\le a_k\}\)</span> 这共计 <span class="arithmatex">\(a_k+2\)</span> 个整点。这说明，就一定有 <span class="arithmatex">\(I=0\)</span> 和 <span class="arithmatex">\(B=a_k+2\)</span>。因而，三角形的边上没有更多的整点，三角形内部也没有整点。也就是说，<span class="arithmatex">\(q_k\)</span> 和 <span class="arithmatex">\(p_k\)</span> 是既约的，中间分数是连结 <span class="arithmatex">\(\vec\xi_{k-2}\)</span> 和 <span class="arithmatex">\(\vec\xi_k\)</span> 的边上的全部整点，且第一象限的所有整点都在上下两个凸包内。</p>
</li>
</ul>
</details>
<p data-original-document-end="28305" data-original-document-start="28166">这样得到的上下两个凸包称为 Klein 多边形。在高维空间内也可以做类似定义，得到 <a href="https://en.wikipedia.org/wiki/Klein_polyhedron">Klein 多面体</a>（Klein polyhedron），它可以将连分数的概念推广到高维空间内。</p>
<h2 id="连分数的树">连分数的树<a class="headerlink" href="#连分数的树" title="Permanent link"></a></h2>
<p data-original-document-end="28366" data-original-document-start="28317">主条目：<a href="../stern-brocot/">Stern–Brocot 树与 Farey 序列</a></p>
<p data-original-document-end="28646" data-original-document-start="28368">Stern–Brocot 树是存储了所有位于 <span class="arithmatex">\([0,\infty]\)</span> 之间的分数的 <a href="../../ds/bst.md">二叉搜索树</a>。有限连分数实际上编码了 Stern–Brocot 树上从根到某个分数所在位置的路径。也就是说，有理数 <span class="arithmatex">\(x\)</span> 的连分数表示 <span class="arithmatex">\([a_0,a_1,\cdots,a_{n-1},1]\)</span> 意味着从树根 <span class="arithmatex">\(\dfrac{1}{1}\)</span> 开始，需要先向右子节点移动 <span class="arithmatex">\(a_0\)</span> 次，再向左子节点移动 <span class="arithmatex">\(a_1\)</span> 次，交替方向移动，直到向某个方向移动了 <span class="arithmatex">\(a_{n-1}\)</span> 次为止。应当注意，此处只能使用末尾为 <span class="arithmatex">\(1\)</span> 的连分数表示。</p>
<p data-original-document-end="28692" data-original-document-start="28648">将连分数表示理解为 Stern–Brocot 树上的路径，可以得到比较连分数大小的算法。</p>
<details class="example" data-original-document-end="28822" data-original-document-start="28694" open="open">
<summary>连分数大小比较</summary>
<p>给定连分数 <span class="arithmatex">\(\alpha=[\alpha_0,\alpha_1,\cdots,\alpha_n]\)</span> 和 <span class="arithmatex">\(\beta=[\beta_0,\beta_1,\cdots,\beta_m]\)</span>，比较两者大小。</p>
</details>
<details class="note" data-original-document-end="29220" data-original-document-start="29170">
<summary>解答</summary>
<p>首先将两个连分数表示都转化成末尾是 <span class="arithmatex">\(1\)</span> 的形式。不妨设题目所给的已经是这样形式的连分数，即 <span class="arithmatex">\(\alpha_n=\beta_m=1\)</span>。因为偶数位置（下标从 <span class="arithmatex">\(0\)</span> 开始）是向右移动的步数，奇数位置是向左移动的步数，所以，<span class="arithmatex">\(\alpha&lt;\beta\)</span> 当且仅当按照 <a href="../../../string/basic/#字典序">字典序</a> 比较时，有</p>
<div class="arithmatex">\[
(\alpha_0,-\alpha_1,\alpha_2,\cdots,(-1)^{n-1}\alpha_{n-1},0,\cdots)&lt;(\beta_0,-\beta_1,\beta_2,\cdots,(-1)^{m-1}\beta_{m-1},0,\cdots).
\]</div>
<p>相较于连分数表示，交替地添加正负号，删去末尾的 <span class="arithmatex">\(1\)</span>，并且长度不足的位置用 <span class="arithmatex">\(0\)</span> 补齐。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">C++</label><label for="__tabbed_4_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Expand [..., n] to [..., n-1, 1] if needed.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">--</span><span class="n">a</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Check if a is smaller than b.</span>
<span class="kt">bool</span><span class="w"> </span><span class="nf">less_than</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">expand</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="n">expand</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Expand [..., n] to [..., n-1, 1] if needed.</span>
<span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span>


<span class="c1"># Check if a is smaller than b.</span>
<span class="k">def</span> <span class="nf">less_than</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">expand</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">i</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<p data-original-document-end="29482" data-original-document-start="29443">想要了解更多 Stern–Brocot 树的性质和应用，可以参考其主条目页面。</p>
<h2 data-original-document-end="29493" data-original-document-start="29484" id="分式线性变换">分式线性变换<a class="headerlink" href="#分式线性变换" title="Permanent link"></a></h2>
<p data-original-document-end="29520" data-original-document-start="29495">和连分数相关的另一个重要概念是所谓的分式线性变换。</p>
<details class="abstract" data-original-document-end="29727" data-original-document-start="29522" open="open">
<summary>分式线性变换</summary>
<p><strong>分式线性变换</strong>（fractional linear transformation）是指函数 <span class="arithmatex">\(L:\mathbf R\rightarrow\mathbf R\)</span>，使得</p>
<div class="arithmatex">\[
L(x) = \dfrac{ax+b}{cx+d},
\]</div>
<p>其中，<span class="arithmatex">\(a,b,c,d\in\mathbf R\)</span> 且 <span class="arithmatex">\(ad-bc\neq 0\)</span>。</p>
</details>
<details class="info" data-original-document-end="29799" data-original-document-start="29729" open="open">
<summary> 关于条件 <span class="arithmatex">\(ad-bc\neq 0\)</span></summary>
<p>容易验证，当 <span class="arithmatex">\(ad-bc=0\)</span> 时，函数可能没有定义或者是常函数。</p>
</details>
<p data-original-document-end="29813" data-original-document-start="29801">分式线性变换有如下性质：</p>
<details class="note" data-original-document-end="30311" data-original-document-start="29815" open="open">
<summary>分式线性变换的性质</summary>
<p>设 <span class="arithmatex">\(L_1,L_2,L_3\)</span> 是分式线性变换，并记 <span class="arithmatex">\(L_i\)</span> 的系数形成的矩阵为</p>
<div class="arithmatex">\[
M_i=\begin{pmatrix}a_i &amp; b_i \\ c_i &amp; d_i\end{pmatrix}
\]</div>
<p>则它们有如下性质：<sup id="fnref:pgl2"><a class="footnote-ref" href="#fn:pgl2">7</a></sup></p>
<ol>
<li>分式线性变换的复合 <span class="arithmatex">\(L_1\circ L_2\)</span> 和逆变换 <span class="arithmatex">\(L_1^{-1}\)</span> 仍然是分式线性变换，即全体分式线性变换构成 <a href="../../algebra/basic/#群">群</a>；</li>
<li>分式线性变换在系数同乘以非零常数后保持不变，即对于任意 <span class="arithmatex">\(\lambda\neq 0\)</span>，如果 <span class="arithmatex">\(M_2=\lambda M_1\)</span>，则 <span class="arithmatex">\(L_2=L_1\)</span>；</li>
<li>分式线性变换的复合的系数矩阵，对应着系数矩阵的乘积，即如果 <span class="arithmatex">\(M_1M_2=M_3\)</span>，则 <span class="arithmatex">\(L_1\circ L_2=L_3\)</span>；</li>
<li>分式线性变换的逆变换的系数矩阵，对应着系数矩阵的逆矩阵，即如果 <span class="arithmatex">\(M_1^{-1}=M_2\)</span>，则 <span class="arithmatex">\(L_1^{-1}=L_2\)</span>。</li>
</ol>
</details>
<details class="note" data-original-document-end="30659" data-original-document-start="30375">
<summary>证明</summary>
<p>此处仅提供分式线性变换的复合和逆变换的形式。得到这个形式后，所有性质都是容易验证的。</p>
<p>分式线性变换 <span class="arithmatex">\(L_1\)</span> 和 <span class="arithmatex">\(L_2\)</span> 的复合：</p>
<div class="arithmatex">\[
\begin{aligned}
L_1\circ L_2 &amp;= \dfrac{a_1\dfrac{a_2x+b_2}{c_2x+d_2}+b_1}{c_1\dfrac{a_2x+b_2}{c_2x+d_2}+d_1} = \dfrac{(a_1a_2+b_1c_2)x+(a_1b_2+b_1d_2)}{(c_1a_2+d_1c_2)x+(c_1b_2+d_1d_2)}.
\end{aligned}
\]</div>
<p>分式线性变换 <span class="arithmatex">\(L_1(x)\)</span> 的逆变换：</p>
<div class="arithmatex">\[
y = L_1(x) = \dfrac{a_1x+b_1}{c_1x+d_1} \iff x = L_1^{-1}(y) = \dfrac{d_1y - b_1}{-c_1y + a_1}.
\]</div>
</details>
<p data-original-document-end="30826" data-original-document-start="30776">有限连分数 <span class="arithmatex">\([a_0,a_1,\cdots,a_n]\)</span> 可以看做是一系列分式线性变换复合的结果。设</p>
<div class="arithmatex">\[
L_i(x) = \dfrac{a_ix+1}{x} = [a_i,x]. 
\]</div>
<p data-original-document-end="30882" data-original-document-start="30874">那么，有限连分数</p>
<div class="arithmatex">\[
[a_0,a_1,\cdots,a_n] = L_0\circ L_1\circ \cdots L_n(\infty).
\]</div>
<p data-original-document-end="31060" data-original-document-start="30952">其中，分式线性变换 <span class="arithmatex">\(L(x)=\dfrac{ax+b}{cx+d}\)</span> 变换在 <span class="arithmatex">\(x=\infty\)</span> 处的取值是 <span class="arithmatex">\(\dfrac{a}{c}\)</span>，这是函数在 <span class="arithmatex">\(x\rightarrow\pm\infty\)</span> 时的极限值。</p>
<p data-original-document-end="31127" data-original-document-start="31062">对于一般的连分数，设实数 <span class="arithmatex">\(x\)</span> 的余项为 <span class="arithmatex">\(r_{k+1}\)</span>，即 <span class="arithmatex">\(x=[a_0,\cdots,a_k,r_{k+1}]\)</span>，则有</p>
<div class="arithmatex">\[
x = L_0\circ L_1\circ \cdots L_k(r_{k+1}) = \dfrac{p_kr_{k+1}+p_{k-1}}{q_kr_{k+1}+q_{k-1}}.
\]</div>
<p data-original-document-end="31281" data-original-document-start="31228">这同时也给出了分式线性变换 <span class="arithmatex">\(L_0\circ L_1\circ\cdots\circ L_k\)</span> 的形式。</p>
<p data-original-document-end="31305" data-original-document-start="31283">当然也可以直接验证这个表达式。最开始的时候是</p>
<div class="arithmatex">\[
x=\dfrac{x+0}{0x+1}=\dfrac{p_{-1}x+p_{-2}}{q_{-1}x+q_{-2}}.
\]</div>
<p data-original-document-end="31421" data-original-document-start="31374">随后，如果 <span class="arithmatex">\(L_0\circ L_1\circ\cdots\circ L_{k-1}\)</span> 具有</p>
<div class="arithmatex">\[
\dfrac{p_{k-1}x+p_{k-2}}{q_{k-1}x+q_{k-2}}
\]</div>
<p data-original-document-end="31494" data-original-document-start="31473">的形式，那么根据分式线性变换的复合公式，有</p>
<div class="arithmatex">\[
L_0\circ L_1\circ\cdots\circ L_{k-1}\circ L_k = \dfrac{(p_{k-1}a_k+p_{k-2})x+p_{k-1}}{(q_{k-1}a_k+q_{k-2})x+q_{k-1}} = \dfrac{p_kx+p_{k-1}}{q_kx+q_{k-1}}.
\]</div>
<p data-original-document-end="31702" data-original-document-start="31658">这就可以归纳地得到了上述形式。分式线性变换也提供了递推公式和初值条件的另一个角度的理解。</p>
<details class="example" data-original-document-end="31894" data-original-document-start="31704" open="open">
<summary><a href="https://dmoj.ca/problem/dmopc19c7p4">DMOPC '19 Contest 7 P4 - Bob and Continued Fractions</a></summary>
<p>给定正整数数组 <span class="arithmatex">\(a_1,\cdots,a_n\)</span> 和 <span class="arithmatex">\(m\)</span> 组查询，每次查询给定 <span class="arithmatex">\(l\le r\)</span>，并要求计算 <span class="arithmatex">\([a_l,\cdots,a_r]\)</span> 的值。</p>
</details>
<details class="note">
<summary>解答</summary>
<p>将连分数理解为一列分式线性变换的复合在 <span class="arithmatex">\(x=\infty\)</span> 处取值的结果，只需要能够多次查询一段分式线性变换的复合即可。因为每个分式线性变换都可以取逆，所以可以预处理前缀和再用差分的方法查询，复杂度为 <span class="arithmatex">\(O(n+m)\)</span> 的；如果需要修改，也可以用线段树等结构存储。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">C++</label><label for="__tabbed_5_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;tuple&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>

<span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>

<span class="c1">// FLTs. Essentially 2x2 matrix.</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FracLinearTrans</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">mat</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mat</span><span class="p">{}</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mat</span><span class="p">{</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mat</span><span class="p">{</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="w"> </span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="w"> </span><span class="n">inv</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// Get prefix sum of FLTs.</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">FracLinearTrans</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ps</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
<span class="w">  </span><span class="n">ps</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="n">ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Query.</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">q</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Difference.</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps</span><span class="p">[</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">inv</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ps</span><span class="p">[</span><span class="n">r</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="c1">// Correct signs.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># PYTHON IS TOO SLOW TO PASS THIS PROBLEM.</span>
<span class="c1"># JUST FOR REFERENCE.</span>
<span class="n">M</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span> <span class="o">+</span> <span class="mi">7</span>


<span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span>
        <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span>
        <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span>
        <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">%</span> <span class="n">M</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">inv</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">M</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">M</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


<span class="n">n</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">ps</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="c1"># Get presum.</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()):</span>
    <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">mul</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="n">ps</span><span class="p">[</span><span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">ps</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">l</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">u</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">d</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="连分数的四则运算">连分数的四则运算<a class="headerlink" href="#连分数的四则运算" title="Permanent link"></a></h3>
<p data-original-document-end="32320" data-original-document-start="32280">利用分式线性变换，可以完成连分数的四则运算。这个算法最早由 Gosper 提出。</p>
<p data-original-document-end="32435" data-original-document-start="32322">算法的基石是计算连分数的分式线性变换。本节以有限连分数为例，但是因为算法每输出一位，只需要读入有限多个连分数的项，所以对于无限连分数也是适用的，而且可以算到任意精度。结合前文的连分数比较算法，可以精确地比较任意精度的实数差异。</p>
<details class="example" data-original-document-end="32614" data-original-document-start="32437" open="open">
<summary>连分数的分式线性变换</summary>
<p>给定分式线性变换 <span class="arithmatex">\(L(x)=\dfrac{ax+b}{cx+d}\)</span> 和连分数 <span class="arithmatex">\(\alpha=[\alpha_0,\alpha_1,\cdots,\alpha_n]\)</span>，求 <span class="arithmatex">\(\beta=L(\alpha)\)</span> 的连分数表示 <span class="arithmatex">\([\beta_0,\beta_1,\cdots,\beta_m]\)</span>。</p>
</details>
<details class="note" data-original-document-end="34316" data-original-document-start="32862">
<summary>解答</summary>
<p>算法的基本思路就是逐个确定 <span class="arithmatex">\(\beta_i\)</span> 的值。记</p>
<div class="arithmatex">\[
L_\gamma(x) = \gamma+\dfrac{1}{x} = \dfrac{\gamma x+1}{x}.
\]</div>
<p>因为连分数</p>
<div class="arithmatex">\[
L(\alpha) = L\circ L_{\alpha_0}\circ L_{\alpha_1}\circ \cdots \circ L_{\alpha_n}(\infty),
\]</div>
<p>所以，可以向 <span class="arithmatex">\(L\)</span> 通过逐步复合 <span class="arithmatex">\(L_{\alpha_k}\)</span> 的方式计算 <span class="arithmatex">\(L(\alpha)\)</span> 的大小。但是，如果是希望得到 <span class="arithmatex">\(L(\alpha)\)</span> 的连分数表示，那么并不需要完全计算 <span class="arithmatex">\(L(\alpha)\)</span> 的值再求出连分数表示。可以在复合 <span class="arithmatex">\(L_{\alpha_i}\)</span> 的过程中就能判断 <span class="arithmatex">\(\beta_0,\beta_1,\cdots\)</span> 的值。</p>
<p>比如，假设当前计算到</p>
<div class="arithmatex">\[
L\circ L_{\alpha_0}\circ L_{\alpha_1}\circ \cdots \circ L_{\alpha_k}(x) = \dfrac{a_kx+b_k}{c_kx+d_k}
\]</div>
<p>且 <span class="arithmatex">\(c_k,d_k\)</span> 同号。那么，<span class="arithmatex">\(L\circ L_{\alpha_0}\circ L_{\alpha_1}\circ \cdots \circ L_{\alpha_k}(x)\)</span> 在 <span class="arithmatex">\([0,\infty]\)</span> 上单调，且必然取值在 <span class="arithmatex">\(\dfrac{a_k}{c_k}\)</span> 和 <span class="arithmatex">\(\dfrac{b_k}{d_k}\)</span> 之间。所以，如果</p>
<div class="arithmatex">\[
\left\lfloor\dfrac{a_k}{c_k}\right\rfloor = \left\lfloor\dfrac{b_k}{d_k}\right\rfloor,
\]</div>
<p>就可以确定它就是 <span class="arithmatex">\(L\circ L_{\alpha_0}\circ L_{\alpha_1}\circ \cdots \circ L_{\alpha_k}(x)\)</span> 的整数部分 <span class="arithmatex">\(\beta_0\)</span>。此时，在左侧复合 <span class="arithmatex">\(L_{\beta_0}^{-1}\)</span> 就可以得到</p>
<div class="arithmatex">\[
L_{\beta_0}^{-1}\circ L\circ L_{\alpha_0}\circ L_{\alpha_1}\circ \cdots \circ L_{\alpha_k}.
\]</div>
<p>此时，继续添加 <span class="arithmatex">\(L_{\alpha_{k+1}},L_{\alpha_{k+2}},\cdots\)</span> 就可以确定新的整数部分，即 <span class="arithmatex">\(\beta_1\)</span>。这样计算下去，直到确定出所有的 <span class="arithmatex">\(\beta_j\)</span> 的值。</p>
<p>算法要求 <span class="arithmatex">\(c\)</span> 和 <span class="arithmatex">\(d\)</span> 同号，是因为要保证函数的不连续点不在 <span class="arithmatex">\([0,\infty]\)</span> 范围内。这总是可能的，因为简单连分数的定义要求（除了 <span class="arithmatex">\(\alpha_0\)</span> 外的）系数都是正整数。由此可以证明，必然在有限步内成立 <span class="arithmatex">\(c\)</span> 和 <span class="arithmatex">\(d\)</span> 同号，且将在之后一直保持同号。</p>
<p>具体实现时，只需要维护当前的分式线性变换的系数矩阵 <span class="arithmatex">\(\begin{pmatrix}a&amp;b\\c&amp;d\end{pmatrix}\)</span> 并检查 <span class="arithmatex">\(c\)</span> 和 <span class="arithmatex">\(d\)</span> 是否同号以及 <span class="arithmatex">\(\dfrac{a}{c}\)</span> 和 <span class="arithmatex">\(\dfrac{b}{d}\)</span> 是否有相同的整数部分。右复合 <span class="arithmatex">\(L_{\alpha_i}\)</span> 时，就可以得到 <span class="arithmatex">\(\begin{pmatrix}a\alpha_i+b&amp;a\\ c\alpha_i+d&amp;c\end{pmatrix}\)</span>。如果两者整数部分相同为 <span class="arithmatex">\(\beta_j\)</span>，则在结果的连分数内添加 <span class="arithmatex">\(\beta_j\)</span>，并且左复合 <span class="arithmatex">\(L_{\beta_j}^{-1}\)</span>，这相当于计算 <span class="arithmatex">\(\begin{pmatrix}c&amp;d\\ a\bmod c &amp; b \bmod d \end{pmatrix}\)</span>。</p>
</details>
<p data-original-document-end="34350" data-original-document-start="34318">连分数的分式线性变换已经可以用于计算分数和连分数的四则运算问题：</p>
<div class="arithmatex">\[
\dfrac{p}{q}\pm x = \dfrac{\pm qx+p}{0x+q},\ \dfrac{p}{q}x = \dfrac{px+0}{0x+q},\ \frac{p}{q}/x = \dfrac{0x+p}{qx+0}.
\]</div>
<p data-original-document-end="34505" data-original-document-start="34477">对于一般的连分数之间的四则运算，需要用到双分式线性变换：</p>
<div class="arithmatex">\[
x+y = \dfrac{0xy+x+y+0}{0xy+0x+0y+1},\ xy = \dfrac{1xy+0x+0y+0}{0xy+0x+0y+1},\ \dfrac{x}{y} = \dfrac{0xy+x+0y+0}{0xy+0x+y+0}.
\]</div>
<details class="example" data-original-document-end="34891" data-original-document-start="34640" open="open">
<summary>连分数的双分式线性变换</summary>
<p>给定双分式线性变换 <span class="arithmatex">\(L(x,y)=\dfrac{axy+bx+cy+d}{exy+fx+gy+h}\)</span> 和连分数 <span class="arithmatex">\(\alpha=[\alpha_0,\alpha_1,\cdots,\alpha_n]\)</span> 和 <span class="arithmatex">\(\beta=[\beta_0,\beta_1,\cdots,\beta_m]\)</span>，求 <span class="arithmatex">\(\gamma=L(\alpha,\beta)\)</span> 的连分数表示 <span class="arithmatex">\([\gamma_0,\gamma_1,\cdots,\gamma_\ell]\)</span>。</p>
</details>
<details class="note" data-original-document-end="35608" data-original-document-start="35196">
<summary>解答</summary>
<p>与单变量的分式线性变换的情形类似，要确定整数部分只需要保证当前的分式线性变换在 <span class="arithmatex">\((x,y)\in[0,\infty]\times[0,\infty]\)</span> 内的整数部分保持不变，即 <span class="arithmatex">\(e,f,g,h\)</span> 皆同号，且</p>
<div class="arithmatex">\[
\left\lfloor\dfrac{a}{e}\right\rfloor = \left\lfloor\dfrac{b}{f}\right\rfloor = \left\lfloor\dfrac{c}{g}\right\rfloor = \left\lfloor\dfrac{d}{h}\right\rfloor.
\]</div>
<p>右复合要替换成计算 <span class="arithmatex">\(L(x,y)\mapsto L(L_{\alpha_i}(x),y)\)</span> 和 <span class="arithmatex">\(L(x,y)\mapsto L(x,L_{\beta_j}(y))\)</span>，这同样表示成系数的线性变换。左复合则和单变量的情形完全一致，只需要计算取模就可以了。</p>
<p>相较于单变量的情形，双变量的情形需要决定要先复合 <span class="arithmatex">\(L_{\alpha_i}\)</span> 还是 <span class="arithmatex">\(L_{\beta_j}\)</span>。因为复合的顺序与最后的结果无关，所以可以自由选择复合顺序，比如交替地复合 <span class="arithmatex">\(L_{\alpha_i}\)</span> 和 <span class="arithmatex">\(L_{\beta_j}\)</span>。或者采用经验法则，优先复合比值差距更大的维度：如果 <span class="arithmatex">\(\left|\dfrac{b}{f}-\dfrac{d}{h}\right|&gt;\left|\dfrac{c}{g}-\dfrac{d}{h}\right|\)</span>，那么就先复合 <span class="arithmatex">\(L_{\alpha_i}\)</span>；否则，就先复合 <span class="arithmatex">\(L_{\beta_j}\)</span>。</p>
</details>
<h2 data-original-document-end="35618" data-original-document-start="35610" id="循环连分数">循环连分数<a class="headerlink" href="#循环连分数" title="Permanent link"></a></h2>
<p data-original-document-end="35654" data-original-document-start="35620">类似于循环小数的概念，如果连分数的系数形成了循环，就称为循环连分数。</p>
<details class="abstract" data-original-document-end="36125" data-original-document-start="35656" open="open">
<summary>循环连分数</summary>
<p>设连分数 <span class="arithmatex">\(x=[a_0,a_1,a_2,\cdots]\)</span>，且存在自然数 <span class="arithmatex">\(K\)</span> 和正整数 <span class="arithmatex">\(L\)</span> 使得对于任何 <span class="arithmatex">\(k\ge K\)</span>，都有 <span class="arithmatex">\(a_k=a_{k+L}\)</span>，就称连分数 <span class="arithmatex">\(x\)</span> 为 <strong>循环连分数</strong>（periodic continued fraction）。满足这个条件的最小的 <span class="arithmatex">\(L\)</span> 称为它的最小正周期，而在连分数中重复出现的 <span class="arithmatex">\(a_{k},\cdots,a_{k+L-1}\)</span> 序列就称为它的循环节。利用循环节，循环连分数可以写作 <span class="arithmatex">\(x=[a_0,\cdots,a_{k-1},\overline{a_k,\cdots,a_{k+L-1}}]\)</span>。如果 <span class="arithmatex">\(K\)</span> 可以取作 <span class="arithmatex">\(0\)</span>，即 <span class="arithmatex">\(x=[\overline{a_0,\cdots,a_{L-1}}]\)</span>，就称它为 <strong>纯循环连分数</strong>（purely periodic continued fraction），否则称它为 <strong>混循环连分数</strong>（eventually periodic continued fraction）。</p>
</details>
<h3 data-original-document-end="36136" data-original-document-start="36127" id="二次无理数">二次无理数<a class="headerlink" href="#二次无理数" title="Permanent link"></a></h3>
<p data-original-document-end="36230" data-original-document-start="36138">与循环连分数密切相关的概念是 <a href="../quadratic/">（实）二次无理数</a>（quadratic irrational），即整系数二次方程的无理数解。所有的二次无理数都可以表示成</p>
<div class="arithmatex">\[
a+b\sqrt D
\]</div>
<p data-original-document-end="36245" data-original-document-start="36235">的形式，其中，<span class="arithmatex">\(a,b\)</span> 是有理数且 <span class="arithmatex">\(D\)</span> 是无平方因子的正整数。本文提到的二次无理数都默认是实数。而且，<span class="arithmatex">\(a+b\sqrt D\)</span> 的共轭是指 <span class="arithmatex">\(a-b\sqrt{D}\)</span>。</p>
<p data-original-document-end="36366" data-original-document-start="36339">Euler 的结果说明，所有循环连分数都是二次无理数。</p>
<details class="note" data-original-document-end="36410" data-original-document-start="36368" open="open">
<summary>定理（Euler）</summary>
<p>循环连分数表示的都是二次无理数。</p>
</details>
<details class="note" data-original-document-end="36969" data-original-document-start="36680">
<summary>证明</summary>
<p>对于一般的循环连分数 <span class="arithmatex">\(x=[a_0,\cdots,a_{k-1},\overline{a_k,\cdots,a_{k+L-1}}]\)</span>，可以设 <span class="arithmatex">\(y=[\overline{a_k,\cdots,a_{k+L-1}}]\)</span>，则</p>
<div class="arithmatex">\[
\begin{aligned}
x&amp;=[a_0,\cdots,a_{k-1},y] = L_0(y),\\
y&amp;=[a_k,\cdots,a_{k+L-1},y] = L_1(y),
\end{aligned}
\]</div>
<p>其中，<span class="arithmatex">\(L_0(\cdot)\)</span> 和 <span class="arithmatex">\(L_1(\cdot)\)</span> 都是分式线性变换。于是，得到 <span class="arithmatex">\(x\)</span> 满足的方程</p>
<div class="arithmatex">\[
x = L_0\circ L_1\circ L_0^{-1}(x). 
\]</div>
<p>不妨设分式线性变换 <span class="arithmatex">\(L_0\circ L_1\circ L_0^{-1}(x) = \dfrac{ax+b}{cx+d}\)</span>，则得到 <span class="arithmatex">\(x\)</span> 满足的方程</p>
<div class="arithmatex">\[
cx^2+(d-a)x-b=0.
\]</div>
<p>因而，循环连分数都是整系数二次方程的解。又因为无限连分数都是无理数，所以循环连分数都表示了二次无理数。</p>
</details>
<p data-original-document-end="37010" data-original-document-start="36971">Lagrange 的结果说明反过来也成立，因而二次无理数和循环连分数是等价的。</p>
<details class="note" data-original-document-end="37057" data-original-document-start="37012" open="open">
<summary>定理（Lagrange）</summary>
<p>二次无理数可以表示成循环连分数。</p>
</details>
<details class="note" data-original-document-end="39306" data-original-document-start="37156">
<summary>证明</summary>
<p>思路是证明余项会重复出现。设二次无理数 <span class="arithmatex">\(x\)</span> 可以写作</p>
<div class="arithmatex">\[
x = \dfrac{P_0+\sqrt{D}}{Q_0}
\]</div>
<p>的形式，其中，<span class="arithmatex">\(P_0,Q_0,D\)</span> 都是整数且 <span class="arithmatex">\(Q_0\mid D-P_0^2\)</span>。这总是可能的，比如二次无理数 <span class="arithmatex">\(x\)</span> 总可以写成 </p>
<div class="arithmatex">\[
a+b\sqrt{D'} = \dfrac{p_a}{q_a}+\dfrac{p_b}{q_b}\sqrt{D'} = \dfrac{p_aq_b+p_bq_a\sqrt{D'}}{q_aq_b} = \dfrac{p_ap_bq_aq_b+\sqrt{(q_aq_b)^2D'}}{(q_aq_b)^2}
\]</div>
<p>再令 <span class="arithmatex">\(P=p_ap_bq_aq_b\)</span>，<span class="arithmatex">\(Q=(q_aq_b)^2\)</span> 和 <span class="arithmatex">\(D=QD'\)</span> 即可。</p>
<p>将它写成这种形式的好处是，可以证明它的所有余项都具有类似的形式：</p>
<div class="arithmatex">\[
r_k=\dfrac{P_k+\sqrt D}{Q_k},
\]</div>
<p>其中，<span class="arithmatex">\(P_k,Q_k\)</span> 是整数且 <span class="arithmatex">\(Q_k\mid D-P_k^2\)</span>。其中，条件 <span class="arithmatex">\(Q_k\mid D-P_k^2\)</span> 保证了所有余项的分子中，<span class="arithmatex">\(\sqrt{D}\)</span> 前面的系数都是 <span class="arithmatex">\(1\)</span>。</p>
<p>为得到余项的形式，可以使用数学归纳法。当 <span class="arithmatex">\(k=0\)</span> 时，显然。假设已经得到了 <span class="arithmatex">\(r_k\)</span> 的形式，并设 <span class="arithmatex">\(a_k=\lfloor r_k\rfloor\)</span>，就有</p>
<div class="arithmatex">\[
r_k = a_k+\dfrac{1}{r_{k+1}}.
\]</div>
<p>设 <span class="arithmatex">\(r_{k+1}\)</span> 也有类似形式，并和 <span class="arithmatex">\(r_k\)</span> 一起代入上式，有</p>
<div class="arithmatex">\[
\dfrac{P_k+\sqrt D}{Q_k} = a_k + \dfrac{Q_{k+1}}{P_{k+1}+\sqrt{D}} = a_k + \dfrac{Q_{k+1}P_{k+1}-Q_{k+1}\sqrt{D}}{P_{k+1}^2-D}.
\]</div>
<p>因为二次无理数表示成 <span class="arithmatex">\(a+b\sqrt{D}\)</span> 的方式是唯一的，所以比较两侧系数可知</p>
<div class="arithmatex">\[
\dfrac{P_k}{Q_k} = a_k+\dfrac{Q_{k+1}P_{k+1}}{P_{k+1}^2-D},\ \dfrac{1}{Q_k}=-\dfrac{Q_{k+1}}{P_{k+1}^2-D}.
\]</div>
<p>将第二个等式代入第一个等式可以解出 <span class="arithmatex">\(P_{k+1}\)</span>：</p>
<div class="arithmatex">\[
\dfrac{P_k}{Q_k} = a_k-\dfrac{P_{k+1}}{Q_k} \iff P_{k+1} = a_kQ_k-P_k.
\]</div>
<p>再代入第二个等式，就可以解出 <span class="arithmatex">\(Q_{k+1}\)</span>：</p>
<div class="arithmatex">\[
Q_{k+1} = \dfrac{D-P_{k+1}^2}{Q_k} = \dfrac{D-(a_kQ_k-P_k)^2}{Q_k} = -a_k^2Q_k+2a_kP_k+\dfrac{D-P_k^2}{Q_k}.
\]</div>
<p>根据归纳假设，<span class="arithmatex">\(Q_k\mid D-P_k^2\)</span>，所以确实 <span class="arithmatex">\(P_{k+1}\)</span> 和 <span class="arithmatex">\(Q_{k+1}\)</span> 都是整数，即 <span class="arithmatex">\(r_{k+1}\)</span> 也具有所要求的形式。</p>
<p>最后，证明余项只能取得有限多个值，故而必然重复。前文已经求得余项</p>
<div class="arithmatex">\[
\dfrac{P_k+\sqrt{D}}{Q_k} = r_k = -\dfrac{q_{k-2}x-p_{k-2}}{q_{k-1}x-p_{k-1}}
\]</div>
<p>而且对于无理数，总有 <span class="arithmatex">\(r_k&gt;1\)</span>。同时，它的共轭</p>
<div class="arithmatex">\[
\dfrac{P_k-\sqrt{D}}{Q_k} = r_k^* = -\dfrac{q_{k-2}x^*-p_{k-2}}{q_{k-1}x^*-p_{k-1}} = -\dfrac{q_{k-2}}{q_{k-1}}\dfrac{x^*-\dfrac{p_{k-2}}{q_{k-2}}}{x^*-\dfrac{p_{k-1}}{q_{k-1}}}
\]</div>
<p>对于充分大的 <span class="arithmatex">\(k\)</span> 必然小于 <span class="arithmatex">\(0\)</span>，因为</p>
<div class="arithmatex">\[
\dfrac{q_{k-2}}{q_{k-1}}&gt;0,\ \lim_{k\rightarrow\infty}\dfrac{x^*-\dfrac{p_{k-2}}{q_{k-2}}}{x^*-\dfrac{p_{k-1}}{q_{k-1}}}=\dfrac{x^*-x}{x^*-x}=1.
\]</div>
<p>这就说明</p>
<div class="arithmatex">\[
\dfrac{2\sqrt{D}}{Q_k} = r_k-r_k^*&gt;1 \iff 0&lt;Q_k\le 2\sqrt{D}.
\]</div>
<p>因此，<span class="arithmatex">\(Q_k\)</span> 只能取有限多个值。进而，</p>
<div class="arithmatex">\[
D-P_{k}^2=Q_kQ_{k-1}&gt;0 \iff |P_k|&lt;\sqrt{D},
\]</div>
<p>所以，<span class="arithmatex">\(P_k\)</span> 也只能取有限多个值。故而，余项 <span class="arithmatex">\(r_k\)</span> 只有有限多个可能的取值，必然在无限项内重复。</p>
</details>
<p data-original-document-end="39335" data-original-document-start="39308">定理的证明也提供了一个计算二次无理数的余项的递推公式：</p>
<details class="note" data-original-document-end="39539" data-original-document-start="39337" open="open">
<summary>二次无理数的余项递推公式</summary>
<p>二次无理数总可以表示成</p>
<div class="arithmatex">\[
x=\dfrac{P_0+\sqrt{D}}{Q_0}
\]</div>
<p>的形式，且 <span class="arithmatex">\(Q_0\mid D-P^2_0\)</span>。它的余项</p>
<div class="arithmatex">\[
r_{k}=\dfrac{P_k+\sqrt{D}}{Q_k}
\]</div>
<p>中，<span class="arithmatex">\(P_k,Q_k\)</span> 都是整数，且满足递推关系</p>
<div class="arithmatex">\[
\begin{aligned}
P_{k+1} &amp;= a_kQ_k-P_k,\\
Q_{k+1} &amp;= \dfrac{D-P_{k+1}^2}{Q_k}.
\end{aligned}
\]</div>
</details>
<p data-original-document-end="39799" data-original-document-start="39664">这个递推公式可以直接用于二次无理数的连分数的计算，而且根据定理的证明，<span class="arithmatex">\(|P_k|&lt;\sqrt{D}\)</span> 且 <span class="arithmatex">\(Q_k\le 2\sqrt{D}\)</span>。该算法的复杂度取决于循环节的长度，而后者可以证明是 <span class="arithmatex">\(O(\sqrt{D}\log D)\)</span> 的<sup id="fnref:period-surd"><a class="footnote-ref" href="#fn:period-surd">8</a></sup>。</p>
<details class="example" data-original-document-end="39916" data-original-document-start="39801" open="open">
<summary>二次无理数</summary>
<p>给定二次无理数 <span class="arithmatex">\(\alpha=\dfrac{x+y\sqrt{n}}{z}\)</span>，求出其连分数的表示。其中，<span class="arithmatex">\(x,y,z,n\in\mathbf Z\)</span> 且 <span class="arithmatex">\(n&gt;0\)</span> 不是完全平方。</p>
</details>
<details data-original-document-end="40027" data-original-document-start="39918">
<summary>解答</summary>
<p>首先将二次无理数表示成上述形式，再利用递推公式计算即可。连分数的项由 <span class="arithmatex">\(a_k=\lfloor r_k\rfloor\)</span> 给出。为了求出循环节，需要存储 <span class="arithmatex">\((P_k,Q_k)\)</span> 首次出现的下标。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">C++</label><label for="__tabbed_6_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Return the continued fraction and minimal positive period</span>
<span class="c1">//   of a quadratic irrational (x + y * sqrt(n)) / z.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">quadratic_irrational</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">used</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">used</span><span class="p">.</span><span class="n">count</span><span class="p">(((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">((</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dd</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="n">used</span><span class="p">[((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">used</span><span class="p">[((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Return the continued fraction and minimal positive period</span>
<span class="c1">#   of a quadratic irrational (x + y * sqrt(n)) / z.</span>
<span class="k">def</span> <span class="nf">quadratic_irrational</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">used</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span> <span class="o">+</span> <span class="n">dd</span><span class="p">)</span> <span class="o">//</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">used</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="n">q</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">used</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="40468" data-original-document-start="40280" open="open">
<summary><a href="https://timus.online/problem.aspx?space=1&amp;num=1814">Tavrida NU Akai Contest - Continued Fraction</a></summary>
<p>给定 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(k\)</span>，且 <span class="arithmatex">\(x\)</span> 不是完全平方数，<span class="arithmatex">\(0\le k\le 10^9\)</span>。求出 <span class="arithmatex">\(x\)</span> 的第 <span class="arithmatex">\(k\)</span> 个渐近分数 <span class="arithmatex">\(x_k\)</span>。</p>
</details>
<details class="note">
<summary>解答</summary>
<p>首先利用上述算法解出 <span class="arithmatex">\(\sqrt{x}\)</span> 的周期，将循环节表示成分式线性变换，就可以用 <a href="../../binary-exponentiation/">快速幂</a> 获得 <span class="arithmatex">\(x_k\)</span> 的值。当然，对于没有进入循环节和不足一个循环节的部分，需要单独处理。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">C++</label><label for="__tabbed_7_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;tuple&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>

<span class="c1">// Return the continued fraction and minimal positive period</span>
<span class="c1">//   of a quadratic irrational (x + y * sqrt(n)) / z.</span>
<span class="k">auto</span><span class="w"> </span><span class="n">quadratic_irrational</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">used</span><span class="p">;</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">used</span><span class="p">.</span><span class="n">count</span><span class="p">(((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">a</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">((</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dd</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">);</span>
<span class="w">    </span><span class="n">used</span><span class="p">[((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<span class="w">    </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">used</span><span class="p">[((</span><span class="mf">1L</span><span class="n">L</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">q</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Fractional Linear Transformation.</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">FracLinearTrans</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">mat</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">mat</span><span class="p">{</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">}</span><span class="w"> </span><span class="p">{}</span>

<span class="w">  </span><span class="n">FracLinearTrans</span><span class="w"> </span><span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
<span class="w">        </span><span class="p">((</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">)</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">M</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
<span class="w">      </span><span class="n">quadratic_irrational</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w">  </span><span class="c1">// L==a.size()-1 for sqrt(x)</span>
<span class="w">  </span><span class="n">FracLinearTrans</span><span class="w"> </span><span class="n">cyc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cyc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cyc</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// 1/0=Inf.</span>
<span class="w">  </span><span class="n">FracLinearTrans</span><span class="w"> </span><span class="n">res</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// Tail terms.</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">L</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// Binary exponentiation.</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">L</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&gt;&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cyc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">    </span><span class="n">cyc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cyc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cyc</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">// First term.</span>
<span class="w">  </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FracLinearTrans</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d/%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="n">mat</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">floor</span>


<span class="c1"># Return the continued fraction and minimal positive period</span>
<span class="c1">#   of a quadratic irrational (x + y * sqrt(n)) / z.</span>
<span class="k">def</span> <span class="nf">quadratic_irrational</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">z</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">used</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">p</span> <span class="o">+</span> <span class="n">dd</span><span class="p">)</span> <span class="o">//</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">used</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="n">p</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">//</span> <span class="n">q</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">used</span><span class="p">[</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">]</span>


<span class="c1"># Compose (A[0]*x + A[1]) / (A[2]*x + A[3]) and (B[0]*x + B[1]) / (B[2]*x + B[3])</span>
<span class="k">def</span> <span class="nf">combine</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">t</span> <span class="o">%</span> <span class="n">mod</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">]</span>


<span class="c1"># Binary exponentiation.</span>
<span class="k">def</span> <span class="nf">bpow</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span>
        <span class="k">else</span> <span class="n">combine</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">bpow</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="k">else</span> <span class="n">bpow</span><span class="p">(</span><span class="n">combine</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">),</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>


<span class="n">mod</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">9</span> <span class="o">+</span> <span class="mi">7</span>
<span class="n">x</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">quadratic_irrational</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># (x + 0) / (0*x + 1) = x</span>

<span class="c1"># apply ak + 1/x = (ak*x+1)/(1x+0) to (Ax + B) / (Cx + D)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))):</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">combine</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>

<span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># = 1 / 0</span>
<span class="k">while</span> <span class="n">k</span> <span class="o">%</span> <span class="n">T</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">k</span> <span class="o">%</span> <span class="n">T</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">combine</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">combine</span><span class="p">(</span><span class="n">bpow</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">k</span> <span class="o">//</span> <span class="n">T</span><span class="p">),</span> <span class="n">C</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">combine</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">C</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 data-original-document-end="40850" data-original-document-start="40840" id="纯循环连分数">纯循环连分数<a class="headerlink" href="#纯循环连分数" title="Permanent link"></a></h3>
<p data-original-document-end="40903" data-original-document-start="40852">二次无理数是有循环连分数表示的充分必要条件，本节的讨论则给出了实数具有纯循环连分数表示的充分必要条件。</p>
<p data-original-document-end="40977" data-original-document-start="40905">首先，因为纯循环连分数具有类似有限连分数的形式，所以可以做「反序」操作。类似于反序定理，这样得到的连分数表示和原来的连分数表示之间有确定的关系。</p>
<details class="note" data-original-document-end="41218" data-original-document-start="40979" open="open">
<summary>定理（Galois）</summary>
<p>对于纯循环连分数</p>
<div class="arithmatex">\[
x = \left[\overline{a_0,a_1,\cdots,a_{\ell}}\right],
\]</div>
<p>记</p>
<div class="arithmatex">\[
x' = \left[\overline{a_{\ell},\cdots,a_1,a_0}\right].
\]</div>
<p>则 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(x'\)</span> 互为「倒数负共轭」，即 <span class="arithmatex">\(x\)</span> 的共轭的倒数的相反数是 <span class="arithmatex">\(x'\)</span>。</p>
</details>
<details class="note" data-original-document-end="42120" data-original-document-start="41763">
<summary>证明</summary>
<p>因为不要求 <span class="arithmatex">\(\ell+1\)</span> 是最小正周期，所以不妨设 <span class="arithmatex">\(\ell&gt;0\)</span>。利用反序定理可知，</p>
<div class="arithmatex">\[
\begin{aligned}
\dfrac{p_\ell}{p_{\ell-1}} &amp;= [a_\ell,\cdots,a_1,a_0] = \dfrac{p'_\ell}{q'_\ell},\\
\dfrac{q_\ell}{q_{\ell-1}} &amp;= [a_\ell,\cdots,a_1] = \dfrac{p'_{\ell-1}}{q'_{\ell-1}}.
\end{aligned}
\]</div>
<p>因为等式两侧都是既约分数，所以</p>
<div class="arithmatex">\[
p'_\ell = p_\ell,\ q'_\ell = p_{\ell-1},\ p'_{\ell-1}=q_\ell,\ q'_{\ell-1} = q_{\ell-1}.
\]</div>
<p>对于纯循环连分数 <span class="arithmatex">\(x\)</span>，它的第 <span class="arithmatex">\(\ell+1\)</span> 个余项就是 <span class="arithmatex">\(x\)</span>，因此，有</p>
<div class="arithmatex">\[
x = \dfrac{xp_\ell+p_{\ell-1}}{xq_\ell+q_{\ell-1}}.
\]</div>
<p>所以，它满足二次方程</p>
<div class="arithmatex">\[
q_\ell x^2+(q_{\ell-1}-p_\ell)x-p_{\ell-1} = 0.
\]</div>
<p>同理，<span class="arithmatex">\(x'\)</span> 满足二次方程</p>
<div class="arithmatex">\[
q'_\ell(x')^2+(q'_{\ell-1}-p'_\ell)x'-p'_{\ell-1} = 0.
\]</div>
<p>利用系数的关系可知，这个方程可以写作</p>
<div class="arithmatex">\[
p_{\ell-1}(x')^2+(q_{\ell-1}-p_\ell)x'-q_\ell = 0.
\]</div>
<p>令 <span class="arithmatex">\(y=-\dfrac{1}{x'}\)</span>，则 <span class="arithmatex">\(x\)</span> 和 <span class="arithmatex">\(y\)</span> 满足同一个方程。但是，<span class="arithmatex">\(x&gt;0&gt;y\)</span>，因此它们并非同一个根，而是互为共轭的关系，这就证明了原命题。</p>
</details>
<p data-original-document-end="42165" data-original-document-start="42122">Galois 利用这个观察，进一步地给出了二次无理数有纯循环连分数表示的充分必要条件。</p>
<details class="note" open="open">
<summary>定理（Galois）</summary>
<p>二次无理数 <span class="arithmatex">\(x\)</span> 可以表示为纯循环连分数，当且仅当 <span class="arithmatex">\(x&gt;1\)</span> 且它的共轭 <span class="arithmatex">\(-1&lt;x^*&lt;0\)</span>。</p>
</details>
<details class="note" data-original-document-end="43387" data-original-document-start="42410">
<summary>证明</summary>
<p>如果 <span class="arithmatex">\(x\)</span> 是纯循环连分数，那么利用前文的记号，有 <span class="arithmatex">\(a_0=a_{\ell+1}\ge 1\)</span>，故而 <span class="arithmatex">\(x&gt;1\)</span>。又因为它的倒数负共轭也是循环连分数，所以它的共轭 <span class="arithmatex">\(x^*\)</span> 满足 <span class="arithmatex">\(-\dfrac{1}{x^*}&gt;1\)</span>，亦即 <span class="arithmatex">\(-1&lt;x^*&lt;0\)</span>。这就证明了纯循环连分数都满足该条件。</p>
<p>反过来，设二次无理数 <span class="arithmatex">\(x&gt;1\)</span> 且 <span class="arithmatex">\(-1&lt;x^*&lt;0\)</span>。对于 <span class="arithmatex">\(x\)</span> 的余项 <span class="arithmatex">\(r_k\)</span>，有递推关系</p>
<div class="arithmatex">\[
r_k = a_k+\dfrac{1}{r_{k+1}}.
\]</div>
<p>等式两边都是二次无理数，取共轭可知</p>
<div class="arithmatex">\[
r_{k}^* = a_k+\dfrac{1}{r_{k+1}^*}.
\]</div>
<p>利用这个递推关系，可以证明 <span class="arithmatex">\(-1&lt;r_{k}^*&lt;0\)</span> 对所有 <span class="arithmatex">\(k\ge 0\)</span> 都成立。</p>
<p>首先，对于 <span class="arithmatex">\(k=0\)</span>，有 <span class="arithmatex">\(-1&lt;r_0^*=x_0^*&lt;0\)</span>，显然。对于 <span class="arithmatex">\(k\ge 0\)</span>，由简单连分数定义和 <span class="arithmatex">\(x&gt;1\)</span> 可知，<span class="arithmatex">\(a_k\ge 1\)</span>。故而，假设 <span class="arithmatex">\(-1&lt;r_k^*&lt;0\)</span>，就有</p>
<div class="arithmatex">\[
-1&lt;-\dfrac{1}{a_k}&lt; r_{k+1}^* = \dfrac{1}{r_k^*-a_k} &lt; -\dfrac{1}{1+a_k} &lt; 0.
\]</div>
<p>这就归纳地证明了 <span class="arithmatex">\(-1&lt;r_{k}^*&lt;0\)</span> 对所有 <span class="arithmatex">\(k\ge 0\)</span> 都成立。因此，有</p>
<div class="arithmatex">\[
a_k = -\dfrac{1}{r_{k+1}^*}+r_k^* = \left\lfloor-\dfrac{1}{r_{k+1}^*}\right\rfloor.
\]</div>
<p>因为二次无理数一定是循环连分数，所以存在正整数 <span class="arithmatex">\(L\)</span>和至少某个充分大的 <span class="arithmatex">\(k\)</span>，有 <span class="arithmatex">\(r_{k}=r_{k+L}\)</span>。但是，此时必然也有</p>
<div class="arithmatex">\[
a_{k-1} = \left\lfloor-\dfrac{1}{r_{k}^*}\right\rfloor = \left\lfloor-\dfrac{1}{r_{k+L}^*}\right\rfloor = a_{k+L-1}.
\]</div>
<p>故而，</p>
<div class="arithmatex">\[
r_{k-1} = a_{k-1}+\dfrac{1}{r_k} = a_{k+L-1}+\dfrac{1}{r_{k+L}} = r_{k+L-1}.
\]</div>
<p>这意味着最小的能够使得 <span class="arithmatex">\(r_{k}=r_{k+L}\)</span> 成立的 <span class="arithmatex">\(k\)</span> 必然是 <span class="arithmatex">\(0\)</span>。也就是说，<span class="arithmatex">\(x\)</span> 可以表示成纯循环连分数。</p>
</details>
<p data-original-document-end="43463" data-original-document-start="43389">Galois 定理揭示了纯二次不尽根（pure quadratic surd）——即形如 <span class="arithmatex">\(\sqrt{r}\)</span> 的二次无理数——的连分数表示的规律。</p>
<details class="note" data-original-document-end="43679" data-original-document-start="43629" open="open">
<summary>推论</summary>
<p>对于有理数 <span class="arithmatex">\(r&gt;1\)</span>，如果 <span class="arithmatex">\(\sqrt{r}\)</span> 是无理数，那么</p>
<div class="arithmatex">\[
\sqrt{r} = [\lfloor\sqrt{r}\rfloor,\overline{a_1,\cdots,a_{\ell},2\lfloor\sqrt{r}\rfloor}]
\]</div>
<p>且对于任意 <span class="arithmatex">\(1\le k\le\ell\)</span>，都有 <span class="arithmatex">\(a_k = a_{\ell+1-k}\)</span>。</p>
</details>
<details class="note" data-original-document-end="44353" data-original-document-start="43954">
<summary>证明</summary>
<p>对于二次无理数 <span class="arithmatex">\(\sqrt{r}\)</span>，因为 <span class="arithmatex">\(\lfloor\sqrt{r}\rfloor+\sqrt{r}&gt;1\)</span> 且 <span class="arithmatex">\(-1&lt;\lfloor\sqrt{r}\rfloor-\sqrt{r}&lt;0\)</span>，所以 <span class="arithmatex">\(\lfloor\sqrt{r}\rfloor+\sqrt{r}\)</span> 是纯循环连分数：</p>
<div class="arithmatex">\[
\lfloor\sqrt{r}\rfloor+\sqrt{r} = [\overline{2\lfloor\sqrt{r}\rfloor,a_1,\cdots,a_\ell}].
\]</div>
<p>根据上述定理，它的倒数负共轭具有形式</p>
<div class="arithmatex">\[
\dfrac{1}{\sqrt{r}-\lfloor\sqrt{r}\rfloor} = [\overline{a_\ell,\cdots,a_1,2\lfloor\sqrt{r}\rfloor}].
\]</div>
<p>利用连分数的基本性质可知</p>
<div class="arithmatex">\[
\sqrt{r}=\lfloor\sqrt{r}\rfloor+\dfrac{1}{\dfrac{1}{\sqrt{r}-\lfloor\sqrt{r}\rfloor}}=[\lfloor\sqrt{r}\rfloor,\overline{a_\ell,\cdots,a_1,2\lfloor\sqrt{r}\rfloor}].
\]</div>
<p>但是，又由 <span class="arithmatex">\(\lfloor\sqrt{r}\rfloor+\sqrt{r}\)</span> 的连分数表示可知，</p>
<div class="arithmatex">\[
\sqrt{r} = -\lfloor\sqrt{r}\rfloor+\left(\lfloor\sqrt{r}\rfloor+\sqrt{r}\right) = [\lfloor\sqrt{r}\rfloor,\overline{a_1,\cdots,a_\ell,2\lfloor\sqrt{r}\rfloor}].
\]</div>
<p>因为无理数的连分数表示是唯一的，所以比较中间的系数就知道，<span class="arithmatex">\(a_k=a_{\ell+1-k}\)</span> 对所有 <span class="arithmatex">\(1\le k\le\ell\)</span> 都成立。</p>
</details>
<details class="example" data-original-document-end="45879" data-original-document-start="44613">
<summary> 例子：<span class="arithmatex">\(\sqrt{74}\)</span> 的连分数展开 </summary>
<p><span class="arithmatex">\(\sqrt{74}\)</span> 的连分数可以计算如下：（此处仅是为了说明，编程计算应使用前文提到的递归算法）</p>
<div class="arithmatex">\[
\begin{aligned}
\sqrt{74}&amp;=8+(-8)+\sqrt{74}=\left[8,\frac{8+\sqrt{74}}{10}\right]\\
&amp;=\left[8,1+\frac{-2+\sqrt{74}}{10}\right]=\left[8,1,\frac{2+\sqrt{74}}{7}\right]\\
&amp;=\left[8,1,1+\frac{-5+\sqrt{74}}{7}\right]=\left[8,1,1,\frac{5+\sqrt{74}}{7}\right]\\
&amp;=\left[8,1,1,1+\frac{-2+\sqrt{74}}{7}\right]=\left[8,1,1,1,\frac{2+\sqrt{74}}{10}\right]\\
&amp;=\left[8,1,1,1,1+\frac{-8+\sqrt{74}}{10}\right]=\left[8,1,1,1,1,8+\sqrt{74}\right]\\
&amp;=\left[8,1,1,1,1,16+(-8)+\sqrt{74}\right]=\left[8,\overline{1,1,1,1,16}\right]
\end{aligned}
\]</div>
<p>各个余项分别是：</p>
<div class="arithmatex">\[
\begin{alignedat}{3}
r_1&amp;=\frac{8+\sqrt{74}}{10}&amp;&amp;=\left[\overline{1,1,1,1,16}\right]\\
r_2&amp;=\frac{2+\sqrt{74}}{7}&amp;&amp;=\left[\overline{1,1,1,16,1}\right]\\
r_3&amp;=\frac{5+\sqrt{74}}{7}&amp;&amp;=\left[\overline{1,1,16,1,1}\right]\\
r_4&amp;=\frac{2+\sqrt{74}}{10}&amp;&amp;=\left[\overline{1,16,1,1,1}\right]\\
r_5&amp;=8+\sqrt{74}&amp;&amp;=\left[\overline{16,1,1,1,1}\right]
\end{alignedat}
\]</div>
<p>根据 Galois 的结论，余项 <span class="arithmatex">\(r_k\)</span> 和 <span class="arithmatex">\(r_{L+1-k}\)</span> 循环部分恰好相反，因此互为倒数负共轭。如果 <span class="arithmatex">\(\sqrt{D}\)</span> 的循环节长度 <span class="arithmatex">\(L\)</span> 为奇数，那么中间的一项就与自身互为倒数负共轭；如果循环节长度 <span class="arithmatex">\(L\)</span> 为偶数，就不存在这样的项。Pell 方程一节的讨论会说明，循环节长度的奇偶性将决定了方程 <span class="arithmatex">\(x^2-Dy^2=-1\)</span> 是否有解。</p>
</details>
<p data-original-document-end="45945" data-original-document-start="45881">二次无理数 <span class="arithmatex">\(\sqrt{D}\)</span> 的连分数展开主要应用在 <a href="../pell-equation/">Pell 方程</a> 的求解中。</p>
<h2 data-original-document-end="45952" data-original-document-start="45947" id="例题">例题<a class="headerlink" href="#例题" title="Permanent link"></a></h2>
<p data-original-document-end="45995" data-original-document-start="45954">在掌握了基础概念后，需要研究一些具体的例题来理解如何在算法竞赛中应用连分数的方法。</p>
<details class="example" data-original-document-end="46104" data-original-document-start="45997" open="open">
<summary>线下凸包</summary>
<p>给定 <span class="arithmatex">\(r=[a_0,a_1,\cdots,a_n]\)</span>，求出满足 <span class="arithmatex">\(0\le x\le N\)</span> 和 <span class="arithmatex">\(0\le y\le rx\)</span> 的整点 <span class="arithmatex">\((x,y)\)</span> 的集合的凸包。</p>
</details>
<details class="note" data-original-document-end="47860" data-original-document-start="46197">
<summary>解答</summary>
<p>对于无界集合 <span class="arithmatex">\(x\ge 0\)</span>，上凸壳就是直线 <span class="arithmatex">\(y=rx\)</span> 本身。然而，如下图所示，如果还要求 <span class="arithmatex">\(x\le N\)</span>，那么上凸壳最终会偏离直线。</p>
<p><img alt="" src="../images/Lattice-hull.svg" /></p>
<p>从 <span class="arithmatex">\((0,0)\)</span> 开始，可以自左向右地求出上凸壳的所有整点。假设当前已经求出的上凸壳的最后一个整点是 <span class="arithmatex">\((x,y)\)</span>。现在要求出下一个整点 <span class="arithmatex">\((x',y')\)</span>。顶点 <span class="arithmatex">\((x',y')\)</span> 在 <span class="arithmatex">\((x,y)\)</span> 右上方，记 <span class="arithmatex">\((\Delta x,\Delta y)=(x'-x,y'-y)\)</span> 为两者的差值。那么，必然有</p>
<div class="arithmatex">\[
0&lt;\Delta x\le N-x,\ 0\le \Delta y\le r\Delta x.
\]</div>
<p>第二个不等式成立，因为条件 <span class="arithmatex">\(\Delta y&gt;r\Delta x\)</span> 与 <span class="arithmatex">\((x,y)\)</span> 已经在上凸壳上这件事矛盾。观察 <span class="arithmatex">\((\Delta x,\Delta y)\)</span> 需要满足的条件，对于不同的点 <span class="arithmatex">\((x,y)\)</span>，只有 <span class="arithmatex">\(\Delta x\)</span> 的上界在变化。所以，只要能解决这个子问题，就可以递归地求出原问题的所有整点。</p>
<p>进而，考虑子问题的解法。对比于原问题，子问题相当于将 <span class="arithmatex">\(x\)</span> 的上界修改为 <span class="arithmatex">\(N'\)</span>，并求出上凸壳中与原点相邻的第一个整点。记子问题的解为 <span class="arithmatex">\((q,p)\)</span>。那么，<span class="arithmatex">\(p\)</span> 与 <span class="arithmatex">\(q\)</span> 必然是互素的（否则不是第一个整点），且与原点连线的斜率 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 是所有位于直线 <span class="arithmatex">\(y=rx\)</span> 下方且横坐标不超过 <span class="arithmatex">\(N'\)</span> 的整点中最大的（否则不在凸包上）。结合前文的 <a href="#几何解释">几何解释</a> 可知，这样的点 <span class="arithmatex">\((x,y)\)</span> 必然对应于 <span class="arithmatex">\(r\)</span> 的一个下中间分数。因为分母越大的下中间分数离 <span class="arithmatex">\(r\)</span> 越近，所以子问题的解 <span class="arithmatex">\((q,p)\)</span> 对应着所有分母不超过 <span class="arithmatex">\(N'\)</span> 的下中间分数中分母最大的那个。</p>
<p>当然，实际求解时，没必要对每个子问题都重新求出这样的下中间分数。应该首先求出所有的渐近分数，这相当于提供了遍历所有的下中间分数的方法。然后分母从大到小地遍历下中间分数，每次都尝试将它加到前一个整点 <span class="arithmatex">\((x,y)\)</span> 上，直到不能添加为止才继续尝试下一个下中间分数。</p>
<p>此处有一些显然的优化。首先，对于下中间分数 <span class="arithmatex">\((q,p)\)</span>，必然存在奇数 <span class="arithmatex">\(k\)</span> 和 <span class="arithmatex">\(0\le t&lt;a_k\)</span> 使得 <span class="arithmatex">\((q,p)=(q_{k-1},p_{k-1})+t(q_k,p_k)\)</span>。只要找到最大的 <span class="arithmatex">\(t\)</span> 使得 <span class="arithmatex">\(q_{k-1}+tq_k+x\le N\)</span> 满足就好了，亦即 <span class="arithmatex">\(t=\left\lfloor\dfrac{N-q_{k-1}-x}{q_k}\right\rfloor\)</span>。不用担心 <span class="arithmatex">\(t\)</span> 越界，因为更大的下渐近分数 <span class="arithmatex">\((q_{k+2},p_{k+2})\)</span> 已经添加完了。而每次确定添加的次数的时候，直接计算 <span class="arithmatex">\(\left\lfloor\dfrac{N-x}{q}\right\rfloor\)</span> 即可，不必逐个尝试。</p>
<p>优化后的算法的复杂度是 <span class="arithmatex">\(O(n)\)</span> 的。虽然下中间分数对应的整点可能有很多，但是真正成为增量的并不多。下面要说明，所有 <span class="arithmatex">\(0\le t&lt;a_k\)</span> 的下中间分数 <span class="arithmatex">\((q,p)=(q_{k-1},p_{k-1})+t(q_k,p_k)\)</span> 中，至多会出现两个增量。假设这些下中间分数中确实出现了增量，则此时必然有 <span class="arithmatex">\(q_{k-1}\le N-x&lt;q_{k+1}\)</span>。不妨设 <span class="arithmatex">\(t=\left\lfloor\dfrac{N-q_{k-1}-x}{q_k}\right\rfloor\)</span>。如果 <span class="arithmatex">\(t=0\)</span>，则增量就有 <span class="arithmatex">\(\Delta x=q_{k-1}\)</span>，故而添加完增量后，就有 <span class="arithmatex">\(N-x'&lt;q_{k-1}\)</span>，不会再在这些下中间分数中出现新的增量；如果 <span class="arithmatex">\(t&gt;0\)</span>，那么添加完增量后，必然有 <span class="arithmatex">\(N-x'=(N-q_{k-1}-x)\bmod q_k&lt;q_k\)</span>，即使还会在同一段下中间分数中出现新的增量，下次也只能有 <span class="arithmatex">\(t'=0\)</span>。因此，在这样的一段下中间分数中，至多只能出现两个增量。这就说明，总的时间复杂度是 <span class="arithmatex">\(O(n)\)</span> 的。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">C++</label><label for="__tabbed_8_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Find [ah, ph, qh] such that points r[i]=(ph[i], qh[i]) constitute</span>
<span class="c1">// upper convex hull of lattice points on 0 &lt;= x &lt;= N and 0 &lt;= y &lt;= r * x,</span>
<span class="c1">// where r = [a0, a1, a2, ...] and there are ah[i]-1 integer points on the</span>
<span class="c1">// segment between r[i] and r[i+1].</span>
<span class="k">auto</span><span class="w"> </span><span class="n">hull</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">t</span><span class="p">};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ph</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">back</span><span class="p">()};</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">qh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">back</span><span class="p">()};</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">qh</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qh</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qh</span><span class="p">.</span><span class="n">back</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">dq</span><span class="p">;</span>
<span class="w">        </span><span class="n">ah</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<span class="w">        </span><span class="n">ph</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ph</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dp</span><span class="p">);</span>
<span class="w">        </span><span class="n">qh</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">qh</span><span class="p">.</span><span class="n">back</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dq</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">make_tuple</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span><span class="w"> </span><span class="n">ph</span><span class="p">,</span><span class="w"> </span><span class="n">qh</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find [ah, ph, qh] such that points r[i]=(ph[i], qh[i]) constitute</span>
<span class="c1"># upper convex hull of lattice points on 0 &lt;= x &lt;= N and 0 &lt;= y &lt;= r * x,</span>
<span class="c1"># where r = [a0, a1, a2, ...] and there are ah[i]-1 integer points on the</span>
<span class="c1"># segment between r[i] and r[i+1].</span>
<span class="k">def</span> <span class="nf">hull</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ah</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">qh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">dq</span>
                <span class="n">ah</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">ph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dp</span><span class="p">)</span>
                <span class="n">qh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dq</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="48278" data-original-document-start="48101" open="open">
<summary><a href="https://timus.online/problem.aspx?space=1&amp;num=1430">Timus - Crime and Punishment</a></summary>
<p>给定正整数 <span class="arithmatex">\(A,B,N \le 2\times 10^9\)</span>，求 <span class="arithmatex">\(x,y\ge 0\)</span> 使得 <span class="arithmatex">\(Ax+By\le N\)</span> 且 <span class="arithmatex">\(Ax+By\)</span> 尽可能大。</p>
</details>
<details class="note" data-original-document-end="49779" data-original-document-start="48450">
<summary>解答</summary>
<p>这个问题有一个复杂度为 <span class="arithmatex">\(O(\sqrt N)\)</span> 的解法：不妨设 <span class="arithmatex">\(A\ge B\)</span>，因为 <span class="arithmatex">\(A(B+x)+By=Ax+B(A+y)\)</span>，所以只需要在 <span class="arithmatex">\(x\le\min\{N/A, B\}\)</span> 中搜索答案即可。这足够通过本题。但是，如果应用连分数方法，那么时间复杂度就可以降低到 <span class="arithmatex">\(O(\log N)\)</span>。</p>
<p>为了讨论方便，首先通过代换 <span class="arithmatex">\(x\mapsto\left\lfloor N/A\right\rfloor-x\)</span> 来改变 <span class="arithmatex">\(x\)</span> 的符号。令 <span class="arithmatex">\(C=N\bmod A\)</span> 和 <span class="arithmatex">\(M=\left\lfloor N/A\right\rfloor\)</span>，则原问题转化为在 <span class="arithmatex">\(0\le x\le M\)</span> 且 <span class="arithmatex">\(By-Ax\le C\)</span> 的条件下，求最优的 <span class="arithmatex">\((x,y)\)</span> 使得 <span class="arithmatex">\(By-Ax\)</span> 最大。对于每个固定的 <span class="arithmatex">\(x\)</span>，最优的 <span class="arithmatex">\(y\)</span> 的取值为 <span class="arithmatex">\(\left\lfloor\dfrac{Ax+C}{B}\right\rfloor\)</span>。</p>
<p>接下来要说明的是，这个问题和上一个例题具有类似的解法。但是，与上一个例题中使用下中间分数偏离直线不同，本题需要使用上中间分数来接近直线。具体来说，<span class="arithmatex">\(C-(By-Ax)\)</span> 的值正比于点 <span class="arithmatex">\((x,y)\)</span> 与直线 <span class="arithmatex">\(By-Ax=C\)</span> 的距离。要最大化 <span class="arithmatex">\(By-Ax\)</span>，就等价于最小化这个距离。算法的目标是要找到直线 <span class="arithmatex">\(By-Ax=C\)</span> 下方距离它最近的可行的整点。算法的思路就是从最左侧的点开始，沿着这些整点的上凸壳搜索，逐步缩小与直线的距离，直到得到最优解。</p>
<p>在 <span class="arithmatex">\((x,y)\)</span> 的坐标系内，算法从 <span class="arithmatex">\((0,\lfloor C/B\rfloor)\)</span> 出发，递归地寻找并添加最优的增量 <span class="arithmatex">\((\Delta x,\Delta y)\)</span>，且保证添加后的点比起之前更靠近直线 <span class="arithmatex">\(By-Ax=C\)</span>，但是不能到达直线的另一侧，也不能让横坐标大于 <span class="arithmatex">\(M\)</span>。设已经得到的点是 <span class="arithmatex">\((x,y)\)</span>，那么增量 <span class="arithmatex">\((\Delta x,\Delta y)\)</span> 满足的条件就是 </p>
<div class="arithmatex">\[
0&lt;B\Delta y-A\Delta x\le C-(By-Ax),\ 0&lt;\Delta x\le M-x.
\]</div>
<p>按照沿下凸壳搜索的思路，只需要找到满足这些条件的点中 <span class="arithmatex">\(\Delta x\)</span> 最小的即可。将第一个不等式改写成</p>
<div class="arithmatex">\[
\Delta y \le \dfrac{A}{B}\Delta x+\dfrac{C-(By-Ax)}{B}.
\]</div>
<p>结合前文的 <a href="#几何解释">几何解释</a> 可知，只要后面的常数项小于 <span class="arithmatex">\(1\)</span>，那么满足这个不等式的整点 <span class="arithmatex">\((\Delta x,\Delta y)\)</span> 中横坐标最小的，一定对应着某个上中间分数。这是因为它是所有分母不超过它的分母的分数中，从上方逼近某个实数效果最好的，这只能是上中间分数。而每次添加增量后，都会导致 <span class="arithmatex">\(\Delta y\)</span> 的上界变得更紧，这意味着必须考察分母更大的上中间分数。</p>
<p>仿照上一个例题的思路。分母从小到大考察所有上中间分数，如果能够找到横坐标和纵坐标都不越界的上中间分数，就添加进去，并更新相应的上界。当所有可行的上中间分数都添加结束后，得到的就是最优解。相较于之前，这个题目需要同时保证横纵坐标都不越界，需要格外注意。基于和上一个例题类似的论述，不过这次是使用 <span class="arithmatex">\(B\Delta y-A\Delta x\)</span> 代替之前的 <span class="arithmatex">\(\Delta x\)</span>，可以说明这个算法的复杂度是 <span class="arithmatex">\(O(\log\min\{A,B\})\)</span> 的。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">C++</label><label for="__tabbed_9_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">//</span> <span class="n">Find</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">such</span> <span class="n">that</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="n">C</span><span class="p">,</span>
<span class="o">//</span> <span class="n">such</span> <span class="n">that</span> <span class="n">Cy</span> <span class="o">-</span> <span class="n">Ax</span> <span class="ow">is</span> <span class="nb">max</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="o">.</span>
<span class="n">auto</span> <span class="n">closest</span><span class="p">(</span><span class="nb">int</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span> <span class="n">B</span><span class="p">,</span> <span class="nb">int</span> <span class="n">C</span><span class="p">,</span> <span class="nb">int</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="n">C</span> <span class="o">&lt;=&gt;</span> <span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">B</span>
  <span class="n">auto</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">C</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">};</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">));</span>
  <span class="nb">int</span> <span class="n">qh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">B</span> <span class="o">/</span> <span class="n">C</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">qh</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">qh</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">B</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span>
                        <span class="p">(</span><span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
        <span class="nb">int</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="nb">int</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">)</span> <span class="o">/</span> <span class="n">dq</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="n">std</span><span class="p">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">qh</span><span class="p">,</span> <span class="n">ph</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">k</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="p">,</span> <span class="n">ph</span><span class="p">))</span> <span class="o">/</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">qh</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dq</span><span class="p">;</span>
        <span class="n">ph</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dp</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">std</span><span class="p">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">qh</span><span class="p">,</span> <span class="n">ph</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">auto</span> <span class="n">solve</span><span class="p">(</span><span class="nb">int</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span> <span class="n">B</span><span class="p">,</span> <span class="nb">int</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">tie</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">closest</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">N</span> <span class="o">%</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">N</span> <span class="o">/</span> <span class="n">A</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">std</span><span class="p">::</span><span class="n">make_pair</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="n">A</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find (x, y) such that y = (A*x+B) // C,</span>
<span class="c1"># such that Cy - Ax is max and 0 &lt;= x &lt;= N.</span>
<span class="k">def</span> <span class="nf">closest</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="c1"># y &lt;= (A*x + B)/C &lt;=&gt; diff(x, y) &lt;= B</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">C</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span>

    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
    <span class="n">qh</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">B</span> <span class="o">//</span> <span class="n">C</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">B</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">qh</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">B</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span>
                    <span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">)</span> <span class="o">//</span> <span class="n">dq</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">qh</span><span class="p">,</span> <span class="n">ph</span>
                <span class="k">if</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="p">,</span> <span class="n">ph</span><span class="p">))</span> <span class="o">//</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">))</span>
                <span class="n">qh</span><span class="p">,</span> <span class="n">ph</span> <span class="o">=</span> <span class="n">qh</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dq</span><span class="p">,</span> <span class="n">ph</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dp</span>
    <span class="k">return</span> <span class="n">qh</span><span class="p">,</span> <span class="n">ph</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">closest</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">N</span> <span class="o">%</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">N</span> <span class="o">//</span> <span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span> <span class="o">//</span> <span class="n">A</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="50266" data-original-document-start="50011" open="open">
<summary><a href="https://www.codechef.com/problems/ES">June Challenge 2017 - Euler Sum</a></summary>
<p>求 <span class="arithmatex">\(\sum\limits_{x=1}^N \lfloor \mathrm{e}x \rfloor\)</span> 的值，其中，<span class="arithmatex">\(\mathrm{e}\)</span> 是自然对数的底。</p>
<p>提示：<span class="arithmatex">\(e = [2,1,2,1,1,4,1,1,6,1,\cdots,1,2n,1, \cdots]\)</span>。<sup id="fnref:continued-fraction-of-e"><a class="footnote-ref" href="#fn:continued-fraction-of-e">9</a></sup></p>
</details>
<details class="note" data-original-document-end="50499" data-original-document-start="50445">
<summary>解答</summary>
<p>这个和等于集合 <span class="arithmatex">\(\{(x,y):1\le x\le N,1\le y\le\mathrm{e}x\}\)</span> 中的整点个数。在构建完直线 <span class="arithmatex">\(y=\mathrm{e}x\)</span> 下的整点的凸包后，可以使用 <a href="../../geometry/pick.md">Pick 定理</a> 计算整点个数。时间复杂度为 <span class="arithmatex">\(O(\log N)\)</span>。</p>
<p>原问题要求 <span class="arithmatex">\(N \le 10^{4000}\)</span>。此处 C++ 代码仅作示意，并没有实现高精度计算类。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">C++</label><label for="__tabbed_10_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Find sum of floor(k * x) for k in [1, N] and x = [a0; a1, a2, ...]</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sum_floor</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">N</span><span class="o">++</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ah</span><span class="p">,</span><span class="w"> </span><span class="n">ph</span><span class="p">,</span><span class="w"> </span><span class="n">qh</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span><span class="w"> </span><span class="n">ph</span><span class="p">,</span><span class="w"> </span><span class="n">qh</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hull</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// The number of lattice points within a vertical right trapezoid</span>
<span class="w">  </span><span class="c1">// on points (0; 0) - (0; y1) - (dx; y2) - (dx; 0) that has</span>
<span class="w">  </span><span class="c1">// a+1 integer points on the segment (0; y1) - (dx; y2).</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">picks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">dx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dx</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">;</span><span class="w">  </span><span class="c1">// = (A - b + 2) // 2 + b - (y2 + 1)</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">qh</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ans</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">picks</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">ph</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">qh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">qh</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">ah</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">N</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find sum of floor(k * x) for k in [1, N] and x = [a0; a1, a2, ...].</span>
<span class="k">def</span> <span class="nf">sum_floor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span> <span class="o">=</span> <span class="n">hull</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># The number of lattice points within a vertical right trapezoid</span>
    <span class="c1"># on points (0; 0) - (0; y1) - (dx; y2) - (dx; 0) that has</span>
    <span class="c1"># a+1 integer points on the segment (0; y1) - (dx; y2) but with</span>
    <span class="c1"># the number of points on the vertical right line excluded.</span>
    <span class="k">def</span> <span class="nf">picks</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span>  <span class="c1"># = (A - b + 2) // 2 + b - (y2 + 1)</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qh</span><span class="p">)):</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">picks</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ah</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ans</span> <span class="o">-</span> <span class="n">N</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="50904" data-original-document-start="50728" open="open">
<summary><a href="https://open.kattis.com/problems/itsamodmodmodmodworld">NAIPC 2019 - It's a Mod, Mod, Mod, Mod World</a></summary>
<p>给定正整数 <span class="arithmatex">\(p,q,n\)</span>，求 <span class="arithmatex">\(\sum\limits_{i=1}^n [pi \bmod q]\)</span> 的值。</p>
</details>
<details class="note" data-original-document-end="51222" data-original-document-start="51132">
<summary>解答</summary>
<p>因为和式可以变形为</p>
<div class="arithmatex">\[
\sum_{i=1}^n [pi \bmod q] 
=\sum_{i=1}^n\left(pi - q\left\lfloor\dfrac{pi}{q}\right\rfloor\right) = \dfrac{pn(n+1)}{2} - q\sum_{i=1}^n\left\lfloor\dfrac{p}{q}i\right\rfloor,
\]</div>
<p>这个问题可以转化为上一个问题，只要用 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 替代 <span class="arithmatex">\(\mathrm{e}\)</span> 即可。单次查询的时间复杂度为 <span class="arithmatex">\(O(\log\min\{p,q\})\)</span>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">C++</label><label for="__tabbed_11_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sum_floor</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">p</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">sum_floor</span><span class="p">(</span><span class="n">fraction</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="51677" data-original-document-start="51455" open="open">
<summary><a href="https://judge.yosupo.jp/problem/sum_of_floor_of_linear">Library Checker - Sum of Floor of Linear</a></summary>
<p>给定正整数 <span class="arithmatex">\(N,M,A,B\)</span>，求 <span class="arithmatex">\(\displaystyle\sum_{i=0}^{N-1} \left\lfloor \frac{A \cdot i + B}{M} \right\rfloor\)</span> 的值。</p>
</details>
<details class="note" data-original-document-end="51965" data-original-document-start="51790">
<summary>解答</summary>
<p>这是到目前为止最为复杂的题目。它可以通过 <a href="../euclidean/">类欧几里得算法</a> 计算。此处给出基于连分数的算法，时间复杂度是 <span class="arithmatex">\(O(\log\min\{A,B\})\)</span>。</p>
<p>可以通过构造直线 <span class="arithmatex">\(y=\dfrac{Ax+B}{M}\)</span> 以下且 <span class="arithmatex">\(0\le x&lt; N\)</span> 的全部整点的凸包，并用 Pick 定理计算整点的个数。之前已经解决 <span class="arithmatex">\(B=0\)</span> 的情形。对于一般的情形，可以分为两步进行。首先通过添加上中间分数来逐步接近直线（即第二个例题），直到找到最接近直线的点，再通过添加下中间分数来逐步远离直线（即第一个例题）。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">C++</label><label for="__tabbed_12_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">//</span> <span class="n">Find</span> <span class="n">convex</span> <span class="n">hull</span> <span class="n">of</span> <span class="n">lattice</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">such</span> <span class="n">that</span> <span class="n">C</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">A</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">B</span><span class="o">.</span>
<span class="n">auto</span> <span class="n">hull</span><span class="p">(</span><span class="nb">int</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span> <span class="n">B</span><span class="p">,</span> <span class="nb">int</span> <span class="n">C</span><span class="p">,</span> <span class="nb">int</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">auto</span> <span class="n">diff</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="nb">int</span> <span class="n">x</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="p">{</span> <span class="k">return</span> <span class="n">C</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span> <span class="p">};</span>
  <span class="n">auto</span> <span class="n">a</span> <span class="o">=</span> <span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">ah</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ph</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">B</span> <span class="o">/</span> <span class="n">C</span><span class="p">),</span> <span class="n">qh</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">auto</span> <span class="n">insert</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="nb">int</span> <span class="n">dq</span><span class="p">,</span> <span class="nb">int</span> <span class="n">dp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">void</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">())</span> <span class="o">/</span> <span class="n">dq</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">k</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="nb">min</span><span class="p">((</span><span class="nb">int</span><span class="p">)</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">(),</span> <span class="n">ph</span><span class="o">.</span><span class="n">back</span><span class="p">()))</span> <span class="o">/</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">ah</span><span class="o">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="n">qh</span><span class="o">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dq</span><span class="p">);</span>
    <span class="n">ph</span><span class="o">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dp</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span>
                <span class="p">(</span><span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
        <span class="nb">int</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="nb">int</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dq</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">dq</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
        <span class="n">insert</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">insert</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">back</span><span class="p">(),</span> <span class="n">p</span><span class="o">.</span><span class="n">back</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="o">.</span><span class="n">back</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="nb">int</span> <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="nb">int</span> <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">insert</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">std</span><span class="p">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Sum</span> <span class="n">of</span> <span class="n">floor</span> <span class="p">(</span><span class="n">Ax</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="n">M</span> <span class="kn">from</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">N</span><span class="o">-</span><span class="mf">1.</span>
<span class="n">auto</span> <span class="n">solve</span><span class="p">(</span><span class="nb">int</span> <span class="n">N</span><span class="p">,</span> <span class="nb">int</span> <span class="n">M</span><span class="p">,</span> <span class="nb">int</span> <span class="n">A</span><span class="p">,</span> <span class="nb">int</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="nb">int</span><span class="o">&gt;</span> <span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span><span class="p">;</span>
  <span class="n">std</span><span class="p">::</span><span class="n">tie</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span><span class="p">)</span> <span class="o">=</span> <span class="n">hull</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">lattice</span> <span class="n">points</span> <span class="n">within</span> <span class="n">a</span> <span class="n">vertical</span> <span class="n">right</span> <span class="n">trapezoid</span>
  <span class="o">//</span> <span class="n">on</span> <span class="n">points</span> <span class="p">(</span><span class="mi">0</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">0</span><span class="p">;</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span><span class="p">;</span> <span class="n">y2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">that</span> <span class="n">has</span>
  <span class="o">//</span> <span class="n">a</span><span class="o">+</span><span class="mi">1</span> <span class="n">integer</span> <span class="n">points</span> <span class="n">on</span> <span class="n">the</span> <span class="n">segment</span> <span class="p">(</span><span class="mi">0</span><span class="p">;</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">dx</span><span class="p">;</span> <span class="n">y2</span><span class="p">)</span> <span class="n">but</span> <span class="k">with</span>
  <span class="o">//</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">points</span> <span class="n">on</span> <span class="n">the</span> <span class="n">vertical</span> <span class="n">right</span> <span class="n">line</span> <span class="n">excluded</span><span class="o">.</span>
  <span class="n">auto</span> <span class="n">picks</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="nb">int</span> <span class="n">y1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y2</span><span class="p">,</span> <span class="nb">int</span> <span class="n">dx</span><span class="p">,</span> <span class="nb">int</span> <span class="n">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">dx</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span><span class="p">;</span>  <span class="o">//</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">};</span>
  <span class="nb">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">qh</span><span class="o">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ans</span> <span class="o">+=</span> <span class="n">picks</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ah</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ans</span> <span class="o">-</span> <span class="n">N</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find convex hull of lattice (x, y) such that C*y &lt;= A*x+B.</span>
<span class="k">def</span> <span class="nf">hull</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">C</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">fraction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ah</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ph</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span> <span class="o">//</span> <span class="n">C</span><span class="p">]</span>
    <span class="n">qh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">dq</span>
        <span class="k">if</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">//</span> <span class="n">diff</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">))</span>
        <span class="n">ah</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">qh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dq</span><span class="p">)</span>
        <span class="n">ph</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">dp</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">B</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">diff</span><span class="p">(</span><span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">//</span> <span class="p">(</span>
                    <span class="o">-</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dq</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dq</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">insert</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>

    <span class="n">insert</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">))):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dq</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">insert</span><span class="p">(</span><span class="n">dq</span><span class="p">,</span> <span class="n">dp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span>


<span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="n">ah</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">qh</span> <span class="o">=</span> <span class="n">hull</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="c1"># The number of lattice points within a vertical right trapezoid</span>
    <span class="c1"># on points (0; 0) - (0; y1) - (dx; y2) - (dx; 0) that has</span>
    <span class="c1"># a+1 integer points on the segment (0; y1) - (dx; y2) but with</span>
    <span class="c1"># the number of points on the vertical right line excluded.</span>
    <span class="k">def</span> <span class="nf">picks</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">dx</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">+</span> <span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">y2</span>  <span class="c1"># = (A - b + 2) // 2 + b - (y2 + 1)</span>

    <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">qh</span><span class="p">)):</span>
        <span class="n">ans</span> <span class="o">+=</span> <span class="n">picks</span><span class="p">(</span><span class="n">ph</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ph</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">qh</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ah</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ans</span> <span class="o">-</span> <span class="n">N</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<details class="example" data-original-document-end="52471" data-original-document-start="52203" open="open">
<summary><a href="https://codeforces.com/gym/102354/problem/I">OKC 2 - From Modular to Rational</a></summary>
<p>有个未知的有理数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 且 <span class="arithmatex">\(1\le p, q\le 10^9\)</span>，可以询问对某个素数 <span class="arithmatex">\(m\in[10^9,10^{12}]\)</span> 取模后的 <span class="arithmatex">\(pq^{-1}\)</span> 的值。请在不超过十次询问内确定 <span class="arithmatex">\(p\)</span> 和 <span class="arithmatex">\(q\)</span> 的值。</p>
<p>这个问题等价于找到 <span class="arithmatex">\([1,N]\)</span> 中使得 <span class="arithmatex">\(Ax\bmod M\)</span> 最小的 <span class="arithmatex">\(x\)</span>。</p>
</details>
<details class="note" data-original-document-end="53316" data-original-document-start="52594">
<summary>解答</summary>
<p>根据 <a href="../crt/">中国剩余定理</a>，询问对多个素数取模后的结果，相当于询问对这些素数的乘积取模的结果。因此，本题可以看作是询问分数对足够大的模数 <span class="arithmatex">\(m\)</span> 取模后的结果，要求确定分数的分子和分母。</p>
<p>对于某个模数 <span class="arithmatex">\(m\)</span>，使得 <span class="arithmatex">\(qr\equiv p\pmod m\)</span> 成立的数对 <span class="arithmatex">\((p,q)\)</span> 可能并不唯一。假设 <span class="arithmatex">\((p_1,q_1)\)</span> 和 <span class="arithmatex">\((p_2,q_2)\)</span> 都可以使得这个等式成立，那么必然有 <span class="arithmatex">\((p_1q_2-p_2q_1)r\equiv 0\pmod m\)</span>。根据 <span class="arithmatex">\(r\)</span> 的构造可知，<span class="arithmatex">\(r\)</span> 与 <span class="arithmatex">\(m\)</span> 互素，所以 <span class="arithmatex">\(p_1q_2-p_2q_1\equiv 0\pmod m\)</span>，亦即 <span class="arithmatex">\(m\mid(p_1q_2-p_2q_1)\)</span>。如果 <span class="arithmatex">\(p_1q_2-p_2q_1\)</span> 不为零，那么它的绝对值至少是 <span class="arithmatex">\(m\)</span>。问题中限制了 <span class="arithmatex">\(p,q\in[1,10^9]\)</span>，这意味着这个差值不应该超过 <span class="arithmatex">\(10^{18}\)</span>，因此只要取 <span class="arithmatex">\(m&gt;10^{18}\)</span> 就可以保证求出的 <span class="arithmatex">\((p,q)\)</span> 是唯一的。</p>
<p>现在的问题归结为，给定模数 <span class="arithmatex">\(m\)</span> 和余数 <span class="arithmatex">\(r\)</span>，求不超过 <span class="arithmatex">\(n\)</span> 的正整数对 <span class="arithmatex">\((p,q)\)</span> 使得 <span class="arithmatex">\(qr\equiv p\pmod m\)</span>。在已知这样的解是唯一的情况下，其实只要找到 <span class="arithmatex">\(q\in[1,n]\)</span> 时使得 <span class="arithmatex">\(qr\bmod m\)</span> 最小的 <span class="arithmatex">\(q\)</span> 即可，因为此时有且仅有一个 <span class="arithmatex">\(q\)</span> 使得余数不超过 <span class="arithmatex">\(n\)</span>。这正是前面提到的等价表述。</p>
<p>在 <span class="arithmatex">\((q,k)\)</span> 所在的平面坐标系内，这相当于要找到 <span class="arithmatex">\(q\in[1,n]\)</span> 时在直线 <span class="arithmatex">\(qr-km=0\)</span> 下方最接近它的整点，因为余数 <span class="arithmatex">\(qr\bmod m\)</span> 就正比于整点与直线的距离。结合前文的 <a href="#几何解释">几何解释</a> 可知，这样的整点必然对应着有理分数 <span class="arithmatex">\(\dfrac{r}{m}\)</span> 的某个下中间分数。算法复杂度是 <span class="arithmatex">\(O(\log\min\{r,m\})\)</span>。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">C++</label><label for="__tabbed_13_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Find Q that minimizes Q*r mod m for 1 &lt;= k &lt;= n &lt; m.</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">mod_min</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fraction</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">);</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find Q that minimizes Q*r mod m for 1 &lt;= k &lt;= n &lt; m.</span>
<span class="k">def</span> <span class="nf">mod_min</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">fraction</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">convergents</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="ow">or</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h2 data-original-document-end="53564" data-original-document-start="53559" id="习题">习题<a class="headerlink" href="#习题" title="Permanent link"></a></h2>
<ul data-original-document-end="54518" data-original-document-start="53566">
<li><a href="https://onlinejudge.org/index.php?option=com_onlinejudge&amp;Itemid=8&amp;page=show_problem&amp;problem=775">UVa OJ - Continued Fractions</a></li>
<li><a href="https://www.hackerrank.com/contests/projecteuler/challenges/euler064/problem">ProjectEuler+ #64: Odd period square roots</a></li>
<li><a href="https://loj.ac/p/573">「LibreOJ NOI Round #2」单枪匹马</a></li>
<li><a href="https://codeforces.com/contest/305/problem/B">Codeforces Round #184 (Div. 2) - Continued Fractions</a></li>
<li><a href="https://codeforces.com/contest/346/problem/E">Codeforces Round #201 (Div. 1) - Doodle Jump</a></li>
<li><a href="https://codeforces.com/contest/585/problem/C">Codeforces Round #325 (Div. 1) - Alice, Bob, Oranges and Apples</a></li>
<li><a href="http://poj.org/problem?id=3530">POJ Founder Monthly Contest 2008.03.16 - A Modular Arithmetic Challenge</a></li>
<li><a href="http://acm.hdu.edu.cn/showproblem.php?pid=6624">2019 Multi-University Training Contest 5 - fraction</a></li>
<li><a href="https://www.codechef.com/SNCKEL19/problems/EBAIT">SnackDown 2019 Elimination Round - Election Bait</a></li>
</ul>
<h2 data-original-document-end="54532" data-original-document-start="54520" id="参考文献与拓展阅读">参考文献与拓展阅读<a class="headerlink" href="#参考文献与拓展阅读" title="Permanent link"></a></h2>
<ul data-original-document-end="55212" data-original-document-start="54534">
<li>Hardy, G. H., Wright, E. M., Heath-Brown, R., &amp; Silverman, J. (2008). An Introduction to the Theory of Numbers. Oxford Mathematics.</li>
<li>朱尧辰，王连祥《丢番图逼近引论》</li>
<li><a href="https://chaoli.club/index.php/2756">FatFish 的博客 - 连分数入门</a></li>
<li><a href="https://en.wikipedia.org/wiki/Simple_continued_fraction">Simple continued fraction - Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/Periodic_continued_fraction">Periodic continued fraction - Wikipedia</a></li>
<li><a href="https://perl.plover.com/yak/cftalk/INFO/gosper.txt">Gosper's original notes on continued fraction arithmetic algorithms</a></li>
<li><a href="https://hsinhaoyu.github.io/cont_frac/">Understanding Bill Gosper's continued fraction arithmetic (implemented in Python)</a></li>
</ul>
<p data-original-document-end="56206" data-original-document-start="55214"><strong>本页面主要内容译自博文 <a href="https://cp-algorithms.com/algebra/continued-fractions.html">Continued fractions</a>，版权协议为 CC-BY-SA 4.0，内容有改动。</strong></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:one-representation">
<p>自然数 <span class="arithmatex">\(1\)</span> 只有非标准表示：<span class="arithmatex">\(1=[1]=[0,1]\)</span>。&#160;<a class="footnote-backref" href="#fnref:one-representation" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:continuant">
<p>译名来自张明尧、张凡翻译的《具体数学》第 6.7 节。&#160;<a class="footnote-backref" href="#fnref:continuant" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:sqrt5">
<p>此时不能默认既约分数 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 一定是渐近分数，虽然 Legendre 定理表明 <span class="arithmatex">\(\dfrac{p}{q}\)</span> 确实只能是某个渐近分数。对于渐近分数的情形，可以通过渐近分数逼近实数的误差入手加以证明。&#160;<a class="footnote-backref" href="#fnref:sqrt5" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:semi-range">
<p>不同文献可能对此处的 <span class="arithmatex">\(t\)</span> 的取值范围是否包括端点有不同的处理。&#160;<a class="footnote-backref" href="#fnref:semi-range" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:semiconvergent">
<p><span class="arithmatex">\(t=0\)</span> 时，应理解为形式连分数，相当于截断到连分数的倒数第二项。&#160;<a class="footnote-backref" href="#fnref:semiconvergent" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:nose-streching">
<p>此说法并非专业术语。可能转译自俄文文献 <a href="https://old.mccme.ru/free-books/mmmf-lectures/book.14-full.pdf">ЦЕПНЫЕ ДРОБИ</a>，在 Алгоритм «вытягивания носов» 一节。&#160;<a class="footnote-backref" href="#fnref:nose-streching" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:pgl2">
<p>这些性质表明，全体分式线性变换的群同构于 <a href="https://en.wikipedia.org/wiki/Projective_linear_group">射影线性群</a>  <span class="arithmatex">\(PGL_2(\mathbf R)\)</span>。&#160;<a class="footnote-backref" href="#fnref:pgl2" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:period-surd">
<p>证明见 <a href="https://en.wikipedia.org/wiki/Periodic_continued_fraction#Length_of_the_repeating_block">维基百科页面</a> 的参考文献。&#160;<a class="footnote-backref" href="#fnref:period-surd" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:continued-fraction-of-e">
<p>关于自然对数的底 <span class="arithmatex">\(\mathrm{e}\)</span> 的连分数展开的证明可以参考 <a href="https://proofwiki.org/wiki/Continued_Fraction_Expansion_of_Euler%27s_Number">此处</a>。&#160;<a class="footnote-backref" href="#fnref:continued-fraction-of-e" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      no Copyright tqt
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.action.edit", "navigation.tabs", "navigation.instant"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascript/config.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>